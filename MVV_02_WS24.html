<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Einheit 2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Prof. Dr. Stephan Goerigk" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/hygge.css" rel="stylesheet" />
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <script src="libs/fabric/fabric.min.js"></script>
    <link href="libs/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#EE0071"],"pen_size":4,"eraser_size":40,"palette":[]}) })</script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




name: Title slide
class: middle, left
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
# Multivariate Verfahren
***
### Einheit 2: Mehrebenenanalyse - Lineare gemischte Modelle  (1)
##### Wintersemester 2025 | Prof. Dr. Stephan Goerigk

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Einführung in hierarchische Datenstrukturen



* Zentrale Annahme der (multiplen) linearen Regression (siehe Einheit 1):
.center[
**Die Residuen `\((ε_i)\)` sind unabhängig voneinander. **

`\(\varepsilon_i \sim N(0, \sigma_\varepsilon^2)\)` 

`\((\rightarrow\)` unabhängig normalverteilt mit Erwartungswert Null und
konstanter Varianz [Homoskedastizität] `\()\)`
]

* Was genau bedeutet es, wenn `\(ε_i\)`  unabhängig sind?

* ..., dass `\(ε_i\)` nicht systematisch mit einem anderen Merkmal zusammenhängen

* ..., dass der Wert einer Person keine Informationen über den Wert anderer Person enthält

* ..., dass es keine unberücksichtigten Gruppen/Cluster in den Datenpunkten gibt

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Einführung in hierarchische Datenstrukturen

* Unabhängigkeit der Daten bzw. `\(ε_i\)` ist in der Psychologie oft verletzt

* Häufiger Grund: **hierarchischen Datenstrukturen**

.pull-left[

***

Beispiele für hierarchische Daten:

* **Schüler in Klassen (2-Level)**

* gleiche Lehrer
* gleiches Klassenzimmer
* gleiche Mitschüler
* ...

]

.pull-right[
.center[
2-Level Design
&lt;br&gt;&lt;br&gt;
&lt;img src="bilder/Hierarchical_1.png" width="400px" /&gt;
]
]


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Einführung in hierarchische Datenstrukturen

* Unabhängigkeit der Daten bzw. `\(ε_i\)` ist in der Psychologie oft verletzt

* Häufiger Grund: **hierarchischen Datenstrukturen**

.pull-left[
***
Beispiele für hierarchische Daten:

* Schüler in Klassen (2-Level)

* **Schüler in Klassen in Schulen (3-Level)**
]

.pull-right[
.center[
3-Level Design
&lt;br&gt;&lt;br&gt;
&lt;img src="bilder/Hierarchical_2.png" width="400px" /&gt;
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Einführung in hierarchische Datenstrukturen

* Unabhängigkeit der Daten bzw. `\(ε_i\)` ist in der Psychologie oft verletzt

* Häufiger Grund: **hierarchischen Datenstrukturen**

.pull-left[
***
Beispiele für hierarchische Daten:

* Schüler in Klassen (2-Level)

* Schüler in Klassen in Schulen (3-Level)

* **Patienten in Therapeuten in Studienzentren (3-Level)** 
`\(\rightarrow\)` multizentrische klinische Studie

]

.pull-right[
.center[
3-Level Design
&lt;br&gt;&lt;br&gt;
&lt;img src="bilder/Hierarchical_3.png" width="400px" /&gt;
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Einführung in hierarchische Datenstrukturen

* Unabhängigkeit der Daten bzw. `\(ε_i\)` ist in der Psychologie oft verletzt

* Häufiger Grund: **hierarchischen Datenstrukturen**

.pull-left[
***
Beispiele für hierarchische Daten:

* Schüler in Klassen (2-Level)

* Schüler in Klassen in Schulen (3-Level)

* Patienten in Therapeuten in Studienzentren (3-Level) 

* **Messzeitpunkte in Patienten in Therapeuten (3-Level) **
`\(\rightarrow\)` Messwiederholungsdesign
]

.pull-right[
.center[
3-Level Design
&lt;br&gt;&lt;br&gt;
&lt;img src="bilder/Hierarchical_4.png" width="400px" /&gt;
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Einführung in hierarchische Datenstrukturen

Begriffsklärung hierarchische Daten:

* Daten mit mehreren Ebenen (Levels)

* Niedrigere Levels sind in höhere Levels "geschachtelt" (engl. "nested")

* Elemente einer niedrigeren Ebene ist eindeutig einem Element einer höheren Ebene zuordenbar.


`\(\rightarrow\)` Nicht-Berücksichtigung dieser Einflüsse hat **relevante Implationen**!

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Einführung in hierarchische Datenstrukturen

Was folgt aus hierarchische Datenstrukturen:

* Die Merkmale einer höheren Ebene können die Elemente auf niedrigerer Ebene gleichermaßen beeinflussen (z.B. Didaktische Kompetenz des Lehrers die Matheleistung aller Schüler in seiner Klasse)

* Anders gesagt: Personen innerhalb eines Clusters sind sich ähnlicher, weil sie einem gemeinsamen Einfluss ausgesetzt sind

* Messwerte sind voneinander **abhängig**

* Folgen der Nichtbeachtung hierarchischer Datenstrukturen:

* Falsche Prüfverteilung der Regressionskoeffizienten für Signifikanztests wird verwendet 

* `\(\alpha\)`-Inflation, da die Nullhypothese `\((H_0)\)` öfters fälschlich verworfen wird

* **Ökologischer Fehlschluss** kann erfolgen

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Ökologischer Fehlschluss

.pull-left[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;
]
.pull-right[

&lt;small&gt;

* Beispiel: Zusammenhang zwischen Therapiedosis und Symptomlast

* Es scheint ein positiver Zusammenhang zu bestehen. Führt mehr Therapie zu mehr Symptomen?

* Unsere Regression zeigt auch eine positive Steigung:

.code80[

``` r
lm(Symptomschwere ~ Therapiestunden, data = data)
```

```

Call:
lm(formula = Symptomschwere ~ Therapiestunden, data = data)

Coefficients:
    (Intercept)  Therapiestunden  
         1.2907           0.3926  
```
]

* Wie könnte das Ergebnis zustande kommen?
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Ökologischer Fehlschluss

.pull-left[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;
]
.pull-right[

&lt;small&gt;

* Hierarchische Datenstruktur:

  * Klinik 1 behandelt leichte Depressionen

  * Klinik 2 behandelt mittelgradige Depressionen

  * Klinik 3 behandelt schwere Depressionen

* Patienten mit mehr Therapiesitzungen (z. B. 2x wöchentlich statt 1x) weisen eine schnellere Verbesserung in den Symptomen auf

* Innerhalb der Gruppen besteht ein negativer Zusammenhang zwischen Therapiesitzungen und Symptomschwere

* Nichtberücksichtigung der Hierarchie führt zu falscher Schlussfolgerung.

]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Ökologischer Fehlschluss

.pull-left[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;
]
.pull-right[

&lt;small&gt;

Um zu Prüfen inwiefern Annahme unabhäniger `\(\varepsilon_i\)` verletzt ist können wir uns Plot der standardisierten `\(\varepsilon_i\)` gegen standardisiere vorhergesagte Werte anzeigen lassen:

So in der Art sollte der Graph idealerweise aussehen:

.center[
.code80[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;
]
`\(\rightarrow\)` keine Systematik, keine Cluster

]

]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Ökologischer Fehlschluss

.pull-left[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;
]
.pull-right[

&lt;small&gt;

Darstellung der Residuen für unser einfaches lineares Regressionsmodell:

.center[
.code80[

``` r
model = lm(Symptomschwere ~ Therapiestunden, data = data)
plot(model, which = 1) # zum Darstellen der Residuen
```

![](MVV_02_WS24_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;
]
`\(\rightarrow\)` Störeinflüsse hierarch. Datenstruktur sind sichtbar
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Ökologischer Fehlschluss

Weitere Beispiele für Ökologischen Fehlschluss:

* Speed-accuracy-trade off
  
  * Höhere Geschwindigkeit geht mit weniger Fehlern einher (zwischen Personen)
  
  * Höhere Geschwindigkeit geht mit mehr Fehlern einher (innerhalb von Personen)

* Training und Müdigkeit
  
  * Mehr Training führt zu weniger Müdigkeit (zwischen Personen)
  
  * Mehr Training führt zu mehr Müdigkeit (innerhalb von Personen)

* ...

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lösungsansätze um hierarchische Daten zu berücksichtigen

Lösungsversuch: Gruppen getrennt modellieren

* 1 Regressionsmodell pro Gruppe `\(\rightarrow\)` 1 Steigung pro Gruppe

* Problem 1: Overfitting innerhalb der Gruppen

* Problem 2: Wie soll man Innergruppeneffekte zusammenfassen, um zu einer Gesamtaussage zu kommen?

* Problem 3: Heterogenität innerhalb der Gruppen wird abgebildet, aber Heterogenität zwischen Gruppen wird ignoriert

Lösung: Regressionsansatz der...

* ... Effekt auf Gruppen- und Individualebene in einer Gleichung simultan schätzt

* ... diese dadurch voneinander abtrennbar macht

* ... Einflüsse von Prädiktoren auf beiden Ebenen schätzen kann

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

&lt;small&gt;

Zur Erinnerung noch einmal unser normales (multiples) lineares Regressionmodell:

`$$Y_i = \beta_0 + \beta_1 \cdot X_{1i} + \beta_2 \cdot X_{2i} + ... +\beta_k \cdot X_{ki} + \varepsilon_i, \quad \varepsilon_i \sim N(0, \sigma^2_{\varepsilon})$$`
* `\(\beta_0\)`, `\(\beta_1\)`, `\(\beta_2\)`, ... repräsentieren die **durchschnittliche** Steigung der Regressionsgrade (engl. **fixed effects**).

* Da es sich um den Durchschnitt handelt, gibt es für jeden Koeffizienten ( `\(\beta_0\)`, `\(\beta_1\)`, `\(\beta_2\)`...) nur 1 Schätzwert.

* Wenn hierarchische Datenstruktur vorliegen können die Koeffizienten (z.B. von Schule zu Schule) variieren

* Wir benötigen ein flexibleres Modell, dass diese Unterschiede zwischen Koeffizienten auf Elementen höherer Hierarchielevels berücksichtigt

&lt;br&gt;

Was bedeutet "flexibleres Modell" mathematisch?

`\(\rightarrow\)` Variation der Regressionskoeffizienten auf höheren Hierarchiestufen simultan mitmodellieren (engl. **random effects**)


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

Standard-Regression:

`$$y_i = \beta_0 + \beta_1 x_i + \varepsilon_i$$`

* Im Linear mixed Model fürfen Regressionsparameter variieren.

Wenn `\(\beta_0\)` und `\(\beta_1\)` in jedem Cluster der höheren Hierarchiestufen unterschiedlich sein dürfen:

`$$y_{ij} = \beta_{0j} + \beta_{1j} x_{ij} + \varepsilon_{ij}$$`
&lt;small&gt;

`\(\beta_{0j}\)` = Regressionskonstante (Intercept) im Cluster `\(j\)`  

`\(\beta_{1j}\)` = Steigungsparameter (Slope) im Cluster `\(j\)`  

`\(\varepsilon_{ij}\)` = Fehlervariable (Residual Error) für die Person `\(i\)` in Cluster `\(j\)`  

`\(i\)` = Index für Individuum  

`\(j\)` = Index für Level-2-Einheit (Gruppenindikator)

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

Standard-Regression:

`$$y_i = \beta_0 + \beta_1 x_i + \varepsilon_i$$`

* Im Linear mixed Model fürfen Regressionsparameter variieren.

Wenn `\(\beta_0\)` und `\(\beta_1\)` in jedem Cluster der höheren Hierarchiestufen unterschiedlich sein dürfen:

`$$y_{ij} = \beta_{0j} + \beta_{1j} x_{ij} + \varepsilon_{ij}$$`

&lt;small&gt;

* Jede Person `\(i\)` in Cluster `\(j\)` hat einen Messwert `\(x_{ij}\)` 

* Jedes Cluster `\(j\)` hat einen eigenen Y-Achsenabschnitt `\(\beta_{0j}\)`

* `\(\beta_{0j}\)` ist der durchschnittliche Y-Achsenabschnitt für Messwerte `\(x_{ij}\)`, d.h. aller Personen `\(i\)` in Cluster `\(j\)`

* Jedes Cluster `\(j\)` hat eine eigene Steigung `\(\beta_{1j}\)`

* `\(\beta_{1j}\)` ist die durchschnittliche Steigung für Messwerte `\(x_{ij}\)`, d.h. aller Personen `\(i\)` in Cluster `\(j\)`

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

* `\(\beta_{0}\)` und `\(\beta_{1}\)` sind die durchschnittlichen Koeffizienten im Regressionsmodell

* `\(\beta_{0j}\)` und `\(\beta_{1j}\)` können über die Level-2-Einheiten hinweg variieren

* `\(\beta_{0j}\)` und `\(\beta_{1j}\)` weisen also jeweils Varianz auf

&lt;br&gt;

Nomenklatur Linearer gemischter Modelle:

* Den Durchschnittswert (z.B. der Steigung `\(\beta_1)\)` eines Regressionskoeffizienten nennen wir **Fixed Effekt**

* Die Varianz der (z.B. `\(\beta_{1j})\)` um diesen Durchschnittswert `\((\beta_1)\)` herum nennen wir **Random Effect**

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

Es können auch Modelle geschätzt werden, die nur bezüglich des Y-Achsenabschnitts oder der Steigung variieren:

.center[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

Es können auch Modelle geschätzt werden, die nur bezüglich des Y-Achsenabschnitts oder der Steigung variieren:

.pull-left[
.center[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-14-1.png)&lt;!-- --&gt;
]
]
.pull-right[

&lt;small&gt;

Einfache lineare Regression:

* Feste Parameter, keine Variation

Random Intercept, Fixed Slope (2-Level):

* Y-Achsenabschnitt darf zwischen Gruppen variieren
* Steigung ist über Gruppen hinweg fixiert

Fixed Intercept, Random Slope (2-Level):

* Y-Achsenabschnitt ist über Gruppen hinweg fixiert
* Steigung darf zwischen Gruppen variieren

Random Intercept, Random Slope (2-Level):

* Y-Achsenabschnitt und Steigung dürfen variieren

`\(\rightarrow\)` Wahl des Modells folgt theoretischen Überlegungen

]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

* WICHTIG: Das Konzept **einer** Populations-Regressionsfunktion (Level 1) mit 1 Populations-Intercept und 1 Populations-Steigung wird beibehalten

* Unterschiedliche Intercepts/Steigungen der Gruppen werden auf Ebene der Fixed Effects **nicht** explizit als Interaktionseffekt modelliert

* `\(\beta_0\)` und `\(\beta_1\)` werden auf Level-2 als Kombination aus Durchschnittsintercept `\((\gamma_{00})\)`, bzw. Durchschnittssteigung `\((\gamma_{01})\)` und einer Streuung (Fehler) modelliert.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

* (Durchschnittliche) Fixed Effekte auf Level 1

* Berücksichtigung der Variation über cluster (z.B. Schulen) hinweg auf Level 2

* `\(\beta_{0j}\)` und `\(\beta_{1j}\)` werden als Funktion von Level-2-Parametern modelliert

&lt;br&gt;

Level 1 Gleichung:

`$$y_{ij} = \beta_{0j} + \beta_{1j} x_{ij} + \varepsilon_{ij}$$`

Level 2 Gleichung:

`$$\beta_{0j} = \gamma_{00} + u_{0j}, \quad u_{0j} \sim \mathcal{N}(0, \tau_{00})$$`

`$$\beta_{1j} = \gamma_{10} + u_{1j}, \quad u_{1j} \sim \mathcal{N}(0, \tau_{11})$$`
---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

Durch Berücksichtigung der Hierarchie (Clusterstruktur) gibt es **drei Quellen** von Zufallsvariationen:

1. Level-1-Zufallsfehler: `\(r_{ij}\)` in den y-Werten (Residuen): Abweichungen der Probandenwerte von der Regression.

2. Level-2-Abweichungen: `\(u_{0j}\)` der Random-Intercepts um den Populations-Intercept.

3. Level-2-Abweichungen: `\(u_{1j}\)` der Random-Slopes um die Durchschnittssteigung

* Diese Koeffizienten quantifizieren (in Kombination) die Abweichung... 

  * ...einer spezifischen Person vom Durchschnitt aller Personen (L1) 
  
  * ...einer spezifischen Gruppe vom Durchschnitt aller Gruppen (L2).

* Jede dieser Abweichungen wird als Varianz/Standardabweichung ausgedrückt

* Es ergeben sich somit mehrere voneinander unterscheidbare Varianzkomponenten.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

**Varianzkomponenten:**

* `\(\sigma^2\)`: Residualvarianz auf Level 1 (Varianz der `\(\varepsilon_{ij}\)`)
* `\(\tau_{00}\)`: Varianz der Y-Achsenabschnitte (Varianz der `\(u_{0j}\)`)
* `\(\tau_{11}\)`: Varianz der Steigungskoeffizienten  (Varianz der `\(u_{1j}\)`)
* `\(\tau_{01}\)`: Kovarianz zwischen den Steigungskoeffizienten und Y-Achsenabschnitten (zwischen `\(u_{0j}\)` und `\(u_{1j}\)`)

* `\(\tau_{01}\)`: z.B., positive Kovarianz: Gruppen, die ein höheres Intercept haben, haben einen höheren Slope.

* Für jeden weiteren Prädiktor auf Level 1 gibt es (z.B. für den zweiten Prädiktor) ein `\(\beta_{2j}\)` mit den dazugehörigen Varianzkomponenten:
* `\(\tau_{22}\)` als Varianz der `\(u_{2j}\)`,
* `\(\tau_{21}\)` als Kovarianz der `\(u_{2j}\)` und `\(u_{1j}\)`,
* `\(\tau_{20}\)` als Kovarianz der `\(u_{2j}\)` und `\(u_{0j}\)`.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle (Linear mixed models)

**Einsetzen in eine kombinierte Gleichung:**

&lt;small&gt;

Level 1 Gleichung:

`$$y_{ij} = \beta_{0j} + \beta_{1j} x_{ij} + \varepsilon_{ij}$$`

Level 2 Gleichung:

`$$\beta_{0j} = \gamma_{00} + u_{0j}$$`

`$$\beta_{1j} = \gamma_{10} + u_{1j}$$`
Einsetzen von Level 2 in Level 1:

`$$y_{ij} = \gamma_{00} + u_{0j} + (\gamma_{10} + u_{1j}) x_{ij} + \varepsilon_{ij}$$`

Umstellen und Ausmultiplizieren:

`$$y_{ij} = \color{red}{\gamma_{00} + \gamma_{10} x_{ij}} + \color{blue}{u_{0j} + u_{1j} x_{ij} + \varepsilon_{ij}}$$`

`$$y_{ij} = \color{red}{fixed} + \color{blue}{random}$$`


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Fixed effects vs. Random effects

**Fixed Effects** (feste Effekte)

* Durchschnittliche Intercepts/Steigungen über alle Gruppen hinweg

* Häufig das, was uns beim Hypothesentesten interessiert!

* klassische (multiple) Regressionsmodelle enthalten nur feste Effekte

**Random Effects** (zufällige Effekte)

* Variation von Intercepts/Steigungen über Gruppen hinweg

* Ausmaß der Varianz kann geschätzt werden

* "Bereinigen" die festen Effekte vom Einfluss der hierarchischen Struktur

**Mixed Effects (Regression)** (gemischte Effekte)

* Regressionsmodelle, die fixed und random Effekte beinhalten

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

&lt;small&gt;

In R gibt es mehrere Pakete zur Berechnung von linearen gemischten Modellen:

- **lme4**: Schnell, effizient und ideal für große Datensätze, jedoch ohne standardmäßige `\(p\)`-Werte.
- **lmerTest**: Fügt `\(p\)`-Werte und Freiheitsgrade zu **lme4** hinzu, jedoch etwas langsamer.
- **nlme**: Flexibel, unterstützt verschiedene Fehlerstrukturen, aber langsamer und komplexer.
- **glmmTMB**: Sehr flexibel, arbeitet mit nicht-normalverteilten Daten, jedoch komplexer in der Anwendung.
- **brms**: Bayesianische Modellierung mit großer Flexibilität, aber langsamer und erfordert Kenntnisse der Bayes-Statistik.
- **MCMCglmm**: Bayesianische MCMC-Modellierung, flexibel, aber langsam und komplex.
- **HLMdiag**: Diagnosen für hierarchische Modelle, nützlich in Kombination mit **lme4** oder **nlme**.
- **afex**: Vereinfachte ANOVA-ähnliche gemischte Modelle, jedoch weniger flexibel für komplexe Modelle.

In der Lehrveranstaltung werden wir mit einer Kombination aus **lme4** und **lmerTest** arbeiten.


``` r
# Zur Installation der Pakete:

install.packages("lme4")

install.packages("lmerTest")
```


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[
.center[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;
]
]
.pull-right[

&lt;small&gt;

Einfache lineare Regression:

``` r
lm(y ~ x, data = data)
```

***

Random Intercept, Fixed Slope (2-Level):

``` r
lmer(y ~ x + (1|group), data = data)
```

***

Fixed Intercept, Random Slope (2-Level):

``` r
lmer(y ~ x + (0 + x|group), data = data)
```

***

Random Intercept, Random Slope (2-Level):

``` r
lmer(y ~ x + (x|group), data = data)
```

]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[
.center[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;
]
]

.pull-right[
Ansicht Datensatz in R (Ausschnitt):


```
   Therapiestunden Symptomschwere   Klinik
1              0.1           1.84 Klinik 1
2              0.2           1.85 Klinik 1
3              0.3           2.16 Klinik 1
4              0.4           1.81 Klinik 1
5              0.5           1.78 Klinik 1
21             2.1           2.74 Klinik 2
22             2.2           2.86 Klinik 2
23             2.3           2.64 Klinik 2
24             2.4           2.65 Klinik 2
25             2.5           2.62 Klinik 2
26             2.6           2.36 Klinik 2
41             4.1           3.81 Klinik 3
42             4.2           3.86 Klinik 3
43             4.3           3.60 Klinik 3
44             4.4           4.23 Klinik 3
45             4.5           3.99 Klinik 3
46             4.6           3.48 Klinik 3
```

]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[
.center[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;
]
]

.pull-right[
Einfaches lineares Regressionsmodell:

.code60[

``` r
model = lm(Symptomschwere ~ Therapiestunden, data = data)
summary(model)
```

```

Call:
lm(formula = Symptomschwere ~ Therapiestunden, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.2907 -0.3627  0.0208  0.4243  1.2157 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      1.29071    0.14575   8.856 2.30e-12 ***
Therapiestunden  0.39259    0.04156   9.448 2.44e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5574 on 58 degrees of freedom
Multiple R-squared:  0.6061,	Adjusted R-squared:  0.5993 
F-statistic: 89.26 on 1 and 58 DF,  p-value: 2.442e-13
```
]
]



---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[

* Fixed Effekte

  * `\(\beta_0=\)` 1.29 (Y-Achsenabschnitt)

  * `\(\beta_1=\)` 0.39 (Steigung)

* Varianzkomponenten

  * `\(\sigma^2=0.5574^2=\)` 0.31 (Residualvarianz)

* Interpretation:

  * Ignorieren der hierarchischen Datenstruktur

  * positive Steigung - mehr Therapie führt zu mehr Symptomen (ökologischer Fehlschluss)
]

.pull-right[
Einfaches lineares Regressionsmodell:

.code60[

``` r
model = lm(Symptomschwere ~ Therapiestunden, data = data)
summary(model)
```

```

Call:
lm(formula = Symptomschwere ~ Therapiestunden, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.2907 -0.3627  0.0208  0.4243  1.2157 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      1.29071    0.14575   8.856 2.30e-12 ***
Therapiestunden  0.39259    0.04156   9.448 2.44e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5574 on 58 degrees of freedom
Multiple R-squared:  0.6061,	Adjusted R-squared:  0.5993 
F-statistic: 89.26 on 1 and 58 DF,  p-value: 2.442e-13
```
]
]


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[
.center[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-26-1.png)&lt;!-- --&gt;
]
]

.pull-right[
Random Intercept, Fixed Slope Modell:

.code55[

``` r
model = lmer(Symptomschwere ~ Therapiestunden + (1|Klinik), data = data)
summary(model)
```

```
Linear mixed model fit by REML ['lmerMod']
Formula: Symptomschwere ~ Therapiestunden + (1 | Klinik)
   Data: data

REML criterion at convergence: -9.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.4940 -0.5752 -0.1298  0.5436  2.4178 

Random effects:
 Groups   Name        Variance Std.Dev.
 Klinik   (Intercept) 3.6108   1.9002  
 Residual             0.0339   0.1841  
Number of obs: 60, groups:  Klinik, 3

Fixed effects:
                Estimate Std. Error t value
(Intercept)      3.86411    1.10450   3.499
Therapiestunden -0.45114    0.04114 -10.965

Correlation of Fixed Effects:
            (Intr)
Therapstndn -0.114
```
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[

&lt;small&gt;

* Fixed Effekte

  * `\(\gamma_{00}=\)` 3.86
  
  * `\(\gamma_{10}=\)` -0.45
  
* Varianzkomponenten

  * `\(\sigma^2=\)` 0.03

  * `\(\tau_{00}=\)` 3.61

* Interpretation:

  * Hierarchische Datenstruktur wird berücksichtigt

  * negative Steigung - mehr Therapie führt zu weniger Symptomen
  
  * Mit 1 zusätzlichen Therapiestunde nehmen Symptome um -0.45 Punkte ab
  
  &lt;/small&gt;
]

.pull-right[
Random Intercept, Fixed Slope Modell:

.code55[

``` r
model = lmer(Symptomschwere ~ Therapiestunden + (1|Klinik), data = data)
summary(model)
```

```
Linear mixed model fit by REML ['lmerMod']
Formula: Symptomschwere ~ Therapiestunden + (1 | Klinik)
   Data: data

REML criterion at convergence: -9.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.4940 -0.5752 -0.1298  0.5436  2.4178 

Random effects:
 Groups   Name        Variance Std.Dev.
 Klinik   (Intercept) 3.6108   1.9002  
 Residual             0.0339   0.1841  
Number of obs: 60, groups:  Klinik, 3

Fixed effects:
                Estimate Std. Error t value
(Intercept)      3.86411    1.10450   3.499
Therapiestunden -0.45114    0.04114 -10.965

Correlation of Fixed Effects:
            (Intr)
Therapstndn -0.114
```
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[
.center[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-29-1.png)&lt;!-- --&gt;
]
]

.pull-right[
Random Intercept, Random Slope Modell:

.code55[

``` r
model = lmer(Symptomschwere ~ Therapiestunden + (Therapiestunden|Klinik), data = data)
summary(model)
```

```
Linear mixed model fit by REML ['lmerMod']
Formula: Symptomschwere ~ Therapiestunden + (Therapiestunden | Klinik)
   Data: data

REML criterion at convergence: -9.8

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.3469 -0.5817 -0.1171  0.5837  2.5651 

Random effects:
 Groups   Name            Variance Std.Dev. Corr
 Klinik   (Intercept)     3.182983 1.78409      
          Therapiestunden 0.001463 0.03825  1.00
 Residual                 0.033578 0.18324      
Number of obs: 60, groups:  Klinik, 3

Fixed effects:
                Estimate Std. Error t value
(Intercept)       3.8132     1.0376   3.675
Therapiestunden  -0.4511     0.0465  -9.701

Correlation of Fixed Effects:
            (Intr)
Therapstndn 0.367 
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')
```
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[


&lt;small&gt;

* Fixed Effekte

  * `\(\gamma_{00}=\)` 3.81 (durchschn. Y-Achsenabschnitt)
  
  * `\(\gamma_{10}=\)` -0.45 (durchschn. Steigung)
  
* Varianzkomponenten

  * `\(\sigma^2=\)` 0.03 (Residualvarianz)

  * `\(\tau_{00}=\)` 3.18 (Varianz um durchschn. Y-Achsenabschnitt)

  * `\(\tau_{11}=\)` 0.001 (Varianz um durchschn. Steigung)

  * `\(\tau_{01}=\)` 1 (Korrelation Y-Achsenabschnitt und Steigung)

]

.pull-right[
Random Intercept, Random Slope Modell:

.code55[

``` r
model = lmer(Symptomschwere ~ Therapiestunden + (Therapiestunden|Klinik), data = data)
summary(model)
```

```
Linear mixed model fit by REML ['lmerMod']
Formula: Symptomschwere ~ Therapiestunden + (Therapiestunden | Klinik)
   Data: data

REML criterion at convergence: -9.8

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.3469 -0.5817 -0.1171  0.5837  2.5651 

Random effects:
 Groups   Name            Variance Std.Dev. Corr
 Klinik   (Intercept)     3.182983 1.78409      
          Therapiestunden 0.001463 0.03825  1.00
 Residual                 0.033578 0.18324      
Number of obs: 60, groups:  Klinik, 3

Fixed effects:
                Estimate Std. Error t value
(Intercept)       3.8132     1.0376   3.675
Therapiestunden  -0.4511     0.0465  -9.701

Correlation of Fixed Effects:
            (Intr)
Therapstndn 0.367 
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')
```
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[
.center[
![](MVV_02_WS24_files/figure-html/unnamed-chunk-32-1.png)&lt;!-- --&gt;
]
]

.pull-right[
Random Intercept, Random Slope Modell:

.code50[

``` r
model = lmer(Symptomschwere ~ Therapiestunden + (Therapiestunden|Klinik), data = data)
summary(model)
```

```
Linear mixed model fit by REML ['lmerMod']
Formula: Symptomschwere ~ Therapiestunden + (Therapiestunden | Klinik)
   Data: data

REML criterion at convergence: -7.5

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.16647 -0.64824 -0.07715  0.56942  2.21719 

Random effects:
 Groups   Name            Variance Std.Dev. Corr
 Klinik   (Intercept)     0.49779  0.7055       
          Therapiestunden 0.21973  0.4688   0.84
 Residual                 0.03362  0.1834       
Number of obs: 60, groups:  Klinik, 3

Fixed effects:
                Estimate Std. Error t value
(Intercept)       2.8546     0.4266   6.692
Therapiestunden  -0.2544     0.2736  -0.930

Correlation of Fixed Effects:
            (Intr)
Therapstndn 0.753 
```
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Lineare gemischte Modelle in R

.pull-left[

* Fixed Effekte

  * `\(\gamma_{00}=\)` 2.85
  
  * `\(\gamma_{10}=\)` -0.25
  
* Varianzkomponenten

  * `\(\sigma^2=\)` 0.03

  * `\(\tau_{00}=\)` 0.5

  * `\(\tau_{11}=\)` 0.22

  * `\(\tau_{01}=\)` 0.838

]

.pull-right[
Random Intercept, Random Slope Modell:

.code50[

``` r
model = lmer(Symptomschwere ~ Therapiestunden + (Therapiestunden|Klinik), data = data)
summary(model)
```

```
Linear mixed model fit by REML ['lmerMod']
Formula: Symptomschwere ~ Therapiestunden + (Therapiestunden | Klinik)
   Data: data

REML criterion at convergence: -7.5

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.16647 -0.64824 -0.07715  0.56942  2.21719 

Random effects:
 Groups   Name            Variance Std.Dev. Corr
 Klinik   (Intercept)     0.49779  0.7055       
          Therapiestunden 0.21973  0.4688   0.84
 Residual                 0.03362  0.1834       
Number of obs: 60, groups:  Klinik, 3

Fixed effects:
                Estimate Std. Error t value
(Intercept)       2.8546     0.4266   6.692
Therapiestunden  -0.2544     0.2736  -0.930

Correlation of Fixed Effects:
            (Intr)
Therapstndn 0.753 
```
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Einfluss der hierarchischen Struktur bestimmen

&lt;small&gt;

* Frage: Wie viel Hierarchie steckt in den Daten? Braucht es ein Linear mixed model?
* Mathematisch: Wie viel Varianz geht auf die Unterschiede zwischen Level-2 Einheiten zurück?
* Unconditional Random Effects Model (UREM) = Random-Intercept-Modell ohne Prädiktor
* Mithilfe des UREM wird eine Intra-KLassen-Korrelation (ICC) berechnet 

.pull-left[
.code80[

``` r
model = lmer(Symptomschwere ~ 1 + (1|Klinik), data = data)
summary(model)
```

```
Linear mixed model fit by REML ['lmerMod']
Formula: Symptomschwere ~ 1 + (1 | Klinik)
   Data: data

REML criterion at convergence: 53.1

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.86999 -0.49102  0.04661  0.56602  2.43104 

Random effects:
 Groups   Name        Variance Std.Dev.
 Klinik   (Intercept) 2.1648   1.4713  
 Residual             0.1096   0.3311  
Number of obs: 60, groups:  Klinik, 3

Fixed effects:
            Estimate Std. Error t value
(Intercept)   2.6981     0.8505   3.172
```
]
]


.pull-right[
***
Intra-Klassen-Korrelation:

`$$ICC = \frac{\tau_{00}}{\tau_{00} + \sigma^2}$$`

`$$ICC = \frac{2.16}{2.16 + 0.11}=0.96$$`
96% der Gesamtvarianz können durch die Unterschiede zwischen den Kliniken erklärt werden.

`\(\rightarrow\)` Berücksichtigung der hierarchischen Struktur ist notwendig!
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Hypothesentesten mit linearen gemischten Modellen - Freiheitsgrade (df)

&lt;small&gt;

Freiheitsgrade im LMM sind abhängig von der Intra-Klassen-Korrelation (ICC), dh. vom Ausmaß der Hierarchie in den Daten:

- ** `\(ICC = 1\)` **:  
  * Keine Varianz innerhalb der Cluster
  * alle Messwerte innerhalb eines Clusters sind identisch
  * df = Anzahl der Cluster (abzüglich der geschätzten Parameter für die Prädiktoren)
  
- ** `\(ICC = 0\)` **:  
  * Gruppenzugehörigkeit erklärt keine Varianz in den Messwerten. Das bedeutet
  * Messwert jeder Person variiert unabhängig von der Clusterzugehörigkeit frei variieren kann. 
  * df = Anzahl der Personen (abzüglich der geschätzten Parameter)

- ** `\(0 &lt; ICC &lt; 1\)` **:  
  * Die  Anzahl der Freiheitsgrade liegt irgendwo zwischen der Anzahl der Cluster (L2) und der Anzahl der Personen (L1).

**Satterthwaite-Korrektur &amp; Kenward-Roger-Korrektur** (enthalten im `lmerTest` Paket):  
  Diese Korrekturen adjustieren Freiheitsgrade je nach ICC. Freiheitsgrade können auch dezimale Werte annehmen.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Hypothesentesten mit linearen gemischten Modellen - `\(p\)`-Werte

&lt;small&gt;

* Achtung: **`lme4`**, berichtet keine Freiheitsgrade oder eine der beiden Korrekturen — also auch keine `\(p\)`-Werte.

- R-Paket **`lmerTest`** erweitert **`lme4`** und liefert als default Freiheitsgrade auf Basis der Satterthwaite-Korrektur.

- **Unterschiede in Korrekturen**:  
  Je nach angewandter Korrektur können sich die Freiheitsgrade und `\(p\)`-Werte geringfügig unterscheiden.

.pull-left[
.code70[


``` r
# ohne lmerTest Paket:

model = lmer(Symptomschwere ~ Therapiestunden + (1|Klinik), data = data)

summary(model)$coefficients # $coefficients um nur fixed effects zu zeigen
```

```
                 Estimate Std. Error   t value
(Intercept)      3.447621  1.1541201  2.987229
Therapiestunden -0.245737  0.0662906 -3.706966
```
]

&lt;br&gt;
* keine df und p-Werte

* Frequentistisches Hypothesentesten nicht möglich
]
.pull-right[
.code70[

``` r
library(lmerTest)

model = lmer(Symptomschwere ~ Therapiestunden + (1|Klinik), data = data)

summary(model)$coefficients # $coefficients um nur fixed effects zu zeigen
```

```
                 Estimate Std. Error       df   t value    Pr(&gt;|t|)
(Intercept)      3.447621  1.1541201  2.08900  2.987229 0.091259166
Therapiestunden -0.245737  0.0662906 56.89018 -3.706966 0.000477163
```

&lt;br&gt;

* `\(\gamma_{10}\)`= -0.25, `\(t_{(56.90)}\)`=-3.71, `\(p=.0004\)`

* Mit zusätzlichen Therapiestunden erfolgte eine signifikante Symptomreduktion von -0.25 pro Einheit.
]

]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Hypothesentesten mit linearen gemischten Modellen - Konfidenzintervalle

&lt;small&gt;

* Zur Erinnerung: Konfidenzintervalle werden genutzt, um den Bereich anzugeben, in dem der wahre Wert einer Parameter-Schätzung mit einer bestimmten Wahrscheinlichkeit (z.B. 95%) liegt, und so die Unsicherheit der Schätzung zu quantifizieren.

* Nach Laden des **`lmerTest`** Pakets können auch Konfidenzintervalle mit Satterthwaite-Korrektur berechnet werden:


``` r
library(lmerTest)

model = lmer(Symptomschwere ~ Therapiestunden + (1|Klinik), data = data)

confint(model, level = 0.95)
```

```
                     2.5 %    97.5 %
.sig01           0.8297828  4.741979
.sigma           0.2480310  0.358650
(Intercept)      0.8610277  6.066188
Therapiestunden -0.3730128 -0.107600
```

`\(\rightarrow\)` Mit zusätzlichen Therapiestunden erfolgte eine signifikante Symptomreduktion ( `\(\gamma_{10}\)`=-0.26, `\(CI_{95\%}\)` -0.37 to -0.11).

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Hypothesentesten mit linearen gemischten Modellen - Modellvergleiche

** `\(\chi^2\)`-likelihood ratio test:**
&lt;small&gt;


``` r
einfach = lmer(Symptomschwere ~ Therapiestunden + (1|Klinik), data = data)
komplex = lmer(Symptomschwere ~ Therapiestunden + (Therapiestunden|Klinik), data = data)

anova(einfach, komplex)
```

```
Data: data
Models:
einfach: Symptomschwere ~ Therapiestunden + (1 | Klinik)
komplex: Symptomschwere ~ Therapiestunden + (Therapiestunden | Klinik)
        npar    AIC    BIC   logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)    
einfach    4 50.859 59.237 -21.4297    42.859                         
komplex    6  2.321 14.887   4.8395    -9.679 52.538  2  3.904e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Hypothesentesten mit linearen gemischten Modellen - Modellvergleiche

.pull-left[
.code60[

``` r
anova(einfach, komplex)
```

```
Data: data
Models:
einfach: Symptomschwere ~ Therapiestunden + (1 | Klinik)
komplex: Symptomschwere ~ Therapiestunden + (Therapiestunden | Klinik)
        npar    AIC    BIC   logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)    
einfach    4 50.859 59.237 -21.4297    42.859                         
komplex    6  2.321 14.887   4.8395    -9.679 52.538  2  3.904e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
]

**Relativer Modellfit**

  * Akaike Information Criterion (AIC, kleiner = besser)
  
  * Bayesian Information Criterion (BIC, kleiner = besser)
]

.pull-right[
** `\(\chi^2\)`-likelihood ratio test**

* Aufgeklärte Varianz einfaches Modell vs. aufgeklärte Varianz komplexes Modell 

* Im einfachen Modell müssen weniger Parameter geschätzt werden (`npar`)

* Signifikantes Ergebnis zeigt Überlegenheit des komplexeren Modells

* Nicht-signifikantes Ergebnis `\(\rightarrow\)` einfaches / "sparsameres" Modell beibehalten

]

---
class: top, left
### Take-aways

.full-width[.content-box-gray[

* Lineare gemischte Modelle ermöglichen Analyse von Daten mit **hierarchischen Datenstrukturen**.

* Nicht-Berücksichtigung hierarchischer Datenstrukturen führt zu **Fehlschlüssen** (z.B. ökologischer Fehlschluss).

* Lineare gemischte Modelle werden auf mehreren ineinander geschachtelten **Ebenen** analysiert.

* Lineare gemischte Modelle setzen sich aus **Fixed Effekten** und **Random Effekten** zusammen.

* Je nach Modellkomplexität dürfen unterschiedliche Modellkoeffizienten über Datenstrukturen **variieren** (Random Intercept, Random Slope).

* Ausmaß der hierarchischen Strukturen kann mittels **Intra-Klassen-Korrelation (ICC)** geschätzt werden.

* Signifikanztest der Modellkoeffizienten (Intercept, Steigungen) erfordern **Anpassung der Freiheitsgrade.**
]
]


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "slideNumberFormat": "%current%",
  "highlightStyle": "github",
  "highlightLines": true,
  "countIncrementalSlides": false,
  "ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
