---
title: "Einheit 4"
subtitle: "‚öî<br/>with xaringan"
author: "Prof. Dr. Stephan Goerigk"
institute: "RStudio, PBC"
date: "2016/12/12 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    css: [xaringan-themer.css, "hygge", style.css]
    lib_dir: libs
    nature:
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
    seal: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

library(tidyverse)
library(kableExtra)
library(ggplot2)
library(plotly)
library(htmlwidgets)
library(MASS)
library(ggpubr)
library(xaringanthemer)
library(xaringanExtra)
library(lme4)

style_duo_accent(
  primary_color = "#621C37",
  secondary_color = "#EE0071",
  background_image = "blank.png"
)

xaringanExtra::use_xaringan_extra(c("tile_view"))

use_scribble(
  pen_color = "#EE0071",
  pen_size = 4
  )

knitr::opts_chunk$set(
  fig.retina = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = NA
)

source(file = "base_functions.R")
```

name: Title slide
class: middle, left
<br><br><br><br><br><br><br>
# Multivariate Verfahren
***
### Einheit 4: Mehrebenenanalyse - Lineare gemischte Modelle  (3)
##### `r format(as.Date(data.frame(readxl::read_excel("Multivariate Verfahren Termine.xlsx"))$Datum), "%d.%m.%Y")[4]` | Prof. Dr. Stephan Goerigk


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

* Klinische Trials sind systematische Studien, die dazu dienen, die Sicherheit und Wirksamkeit klinischer Interventionen wie Medikamente, psychotherapeutische Behandlungen oder neue Therapieverfahren zu testen.


* Ziele klinischer Trials:

  * Sicherheit und Wirksamkeit nachweisen
  
  * Vergleich mit bestehenden Standardbehandlungen
  
  * Neue Interventionen validieren

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Beispiel: Das randomisiert kontrollierte Trial (RCT)

.center[

```{r eval = TRUE, echo = F, out.width = "900px"}
knitr::include_graphics("bilder/rct.png")
```
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Phasen Klinischer Studien**

```{r echo=FALSE}
phases_df <- data.frame(
  Phase = c("Phase I (Erste Studien am Menschen)", "Phase II (Erste Wirksamkeitspr√ºfung)", "Phase III (Best√§tigung der Wirksamkeit und Vergleich)", "Phase IV (√úberwachung nach Markteinf√ºhrung [Post-Marketing-Studien])"),
  Ziel = c(
    "Pr√ºfung der Sicherheit und Festlegung einer Dosierung (bei Medikamenten)",
    "Ermittlung der Wirksamkeit und weitergehende Sicherheitspr√ºfung",
    "Vergleich mit bestehenden Standardbehandlungen und Verifikation der Langzeitwirkung und -sicherheit",
    "Langzeit√ºberwachung der Sicherheit, Wirksamkeit und Nebenwirkungen nach der Markteinf√ºhrung"
  ),
  Teilnehmer = c(
    "Kleine Gruppe gesunder Freiwilliger (oder Patienten bei riskanten Therapien)",
    "Gr√∂√üere Gruppe von Patienten, die an der zu behandelnden Krankheit leiden",
    "Gro√üe Patientengruppen (hundert bis tausende)",
    "Noch breitere Anwendungspopulation im klinischen Alltag"
  ),
  Fokus = c(
    "Toxizit√§t, Nebenwirkungen, Dosisfindung",
    "Erste Nachweise f√ºr die Wirksamkeit, Untersuchung von Nebenwirkungen",
    "Best√§tigung der Ergebnisse aus Phase II, h√§ufig Randomisierte Kontrollierte Studien (RCTs)",
    "Erkennung seltener Nebenwirkungen, Langzeitergebnisse und Vergleich mit neuen Entwicklungen"
  )
)

phases_df %>%
  kbl() %>%
  kable_classic(full_width = T, position = "left", font_size = 18)
```

Merke: Klinische Studien sind der Goldstandard zur Sicherstellung der Wirksamkeit und Sicherheit neuer Behandlungsans√§tze.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Spezifische Aspekte f√ºr Psychotherapie-Studien

*	Phasenmodelle k√∂nnen angepasst werden (z. B. Pilotstudien statt Phase I).

*	Besondere Herausforderungen: Langfristige √úberpr√ºfung der Wirksamkeit, Placeboeffekte, Durchf√ºhrung randomisierter Studien.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

```{r echo=FALSE}
study_designs_df <- data.frame(
  Design = c(
    "Randomisierte Kontrollierte Studien (RCTs)",
    "Nicht-Randomisierte Studien",
    "Cross-Over-Designs",
    "Beobachtungsstudien"
  ),
  Definition_Beschreibung = c(
    "Teilnehmer werden zuf√§llig in Interventions- und Kontrollgruppen aufgeteilt.",
    "Kein Zufallsmechanismus bei der Gruppenzuweisung.",
    "Teilnehmer erhalten abwechselnd verschiedene Behandlungen.",
    "Beobachtungen von Teilnehmern ohne experimentelle Eingriffe (z.B., Kohortenstudien, Fall-Kontroll-Studien)."
  ),
  Vorteile = c(
    "Hohe interne Validit√§t durch Randomisierung, Minimierung von Bias.",
    "Praktisch, wenn Randomisierung nicht m√∂glich ist; geringere Kosten.",
    "Jeder Teilnehmer fungiert als eigene Kontrolle.",
    "Einsatz f√ºr Hypothesenbildung, Langzeitrisiken."
  ),
  Beispiele = c(
    "Vergleich einer neuen kognitiven Verhaltenstherapie (CBT) mit einer Standardtherapie.",
    "Praktische Anwendungen, wenn Randomisierung nicht m√∂glich ist.",
    "Vergleich von zwei Psychotherapieans√§tzen bei derselben Personengruppe zu unterschiedlichen Zeitpunkten.",
    "Kohortenstudien zur Langzeitverfolgung, Fall-Kontroll-Studien."
  )
)

study_designs_df %>%
  kbl() %>%
  kable_classic(full_width = T, position = "left", font_size = 18)
```

Merke: Die Wahl des Designs h√§ngt von den Studienzielen, ethischen √úberlegungen und praktischen Herausforderungen ab.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

.pull-left[
**Randomisierte Kontrollierte Studien (RCTs)**
```{r echo=FALSE}
library(DiagrammeR)

DiagrammeR::grViz("
digraph RCT {
  graph [layout = dot, rankdir = TB]  // 'TB' for Top to Bottom layout
  
  # Nodes
  node [shape = rectangle, style = filled, fillcolor = white, fontname = Helvetica]
  Population [label = 'Population']
  Randomisierung [label = 'Randomisierung']
  Interventionsgruppe [label = 'Interventionsgruppe']
  Kontrollgruppe [label = 'Kontrollgruppe']
  ErgebnisIntervention [label = 'Ergebnismessung (Intervention)']
  ErgebnisKontrolle [label = 'Ergebnismessung (Kontrolle)']

  # Edges
  Population -> Randomisierung
  Randomisierung -> Interventionsgruppe
  Randomisierung -> Kontrollgruppe
  Interventionsgruppe -> ErgebnisIntervention
  Kontrollgruppe -> ErgebnisKontrolle
}
")
```
]

.pull-right[
**Nicht-Randomisierte Studien (Kohortenstudien)**
```{r echo=FALSE}
DiagrammeR::grViz("
digraph RCT {
  graph [layout = dot, rankdir = TB]  // 'TB' for Top to Bottom layout
  
  # Nodes
  node [shape = rectangle, style = filled, fillcolor = white, fontname = Helvetica]
  Population [label = 'Population']
  Randomisierung [label = 'Nat√ºrliche Allokation']
  Interventionsgruppe [label = 'Interventionsgruppe']
  Kontrollgruppe [label = 'Kontrollgruppe']
  ErgebnisIntervention [label = 'Ergebnismessung (Intervention)']
  ErgebnisKontrolle [label = 'Ergebnismessung (Kontrolle)']

  # Edges
  Population -> Randomisierung
  Randomisierung -> Interventionsgruppe
  Randomisierung -> Kontrollgruppe
  Interventionsgruppe -> ErgebnisIntervention
  Kontrollgruppe -> ErgebnisKontrolle
}
")
```
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

.pull-left[
**Cross-Over-Designs**
```{r echo=FALSE, fig.height=5}
DiagrammeR::grViz("
digraph CrossOver {
  graph [layout = dot, rankdir = TB]  // 'TB' for Top to Bottom layout
  
  # Nodes
  node [shape = rectangle, style = filled, fillcolor = white, fontname = Helvetica]
  Population [label = 'Population']
  Randomisierung [label = 'Randomisierung']
  GruppeA_Intervention [label = 'Gruppe A: Intervention']
  GruppeA_Kontrolle [label = 'Gruppe A: Kontrolle']
  GruppeB_Intervention [label = 'Gruppe B: Intervention']
  GruppeB_Kontrolle [label = 'Gruppe B: Kontrolle']
  CrossOverPhase [label = 'Cross-Over-Phase']

  # Edges
  Population -> Randomisierung
  Randomisierung -> GruppeA_Intervention
  Randomisierung -> GruppeB_Kontrolle
  GruppeA_Intervention -> CrossOverPhase
  GruppeB_Kontrolle -> CrossOverPhase
  CrossOverPhase -> GruppeA_Kontrolle
  CrossOverPhase -> GruppeB_Intervention
}
")
```
]

.pull-right[
**Beobachtungsstudien**
```{r echo=FALSE, fig.height=5}
DiagrammeR::grViz("
digraph Observational {
  graph [layout = dot, rankdir = TB]  // 'TB' for Top to Bottom layout
  
  # Nodes
  node [shape = rectangle, style = filled, fillcolor = white, fontname = Helvetica]
  Population [label = 'Population']
  GruppeExposure [label = 'Gruppe mit Exposition']
  GruppeNoExposure [label = 'Gruppe ohne Exposition']
  OutcomeExposed [label = 'Beobachtung des Ergebnisses\n (Exponierte Gruppe)']
  OutcomeUnexposed [label = 'Beobachtung des Ergebnisses\n (Nicht-Exponierte Gruppe)']
  Vergleich [label = 'Vergleich der Ergebnisse']

  # Edges
  Population -> GruppeExposure
  Population -> GruppeNoExposure
  GruppeExposure -> OutcomeExposed
  GruppeNoExposure -> OutcomeUnexposed
  OutcomeExposed -> Vergleich
  OutcomeUnexposed -> Vergleich
}
")
```
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

Studiendesign f√ºr Phase-III RCT (Methodenteil) - CONSORT Checkliste

<small>

<table style="width:100%; border:1px solid black; border-collapse:collapse;">
  <tr>
    <th style="border:1px solid black; padding:8px;">Abschnitt/Thema</th>
    <th style="border:1px solid black; padding:8px;">Punkt Nr.</th>
    <th style="border:1px solid black; padding:8px;">Checkliste Punkt</th>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Studiendesign</td>
    <td style="border:1px solid black; padding:8px;">3a</td>
    <td style="border:1px solid black; padding:8px;">Beschreibung des Studiendesigns (z.B. parallel, faktoriell) einschlie√ülich des Zuweisungsverh√§ltnisses</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">3b</td>
    <td style="border:1px solid black; padding:8px;">Wichtige √Ñnderungen der Methoden nach Beginn der Studie (z.B. Einschlusskriterien), mit Begr√ºndungen</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Teilnehmer</td>
    <td style="border:1px solid black; padding:8px;">4a</td>
    <td style="border:1px solid black; padding:8px;">Einschlusskriterien f√ºr Teilnehmer</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">4b</td>
    <td style="border:1px solid black; padding:8px;">Kontexte und Orte, an denen die Daten erhoben wurden</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Interventionen</td>
    <td style="border:1px solid black; padding:8px;">5</td>
    <td style="border:1px solid black; padding:8px;">Die Interventionen f√ºr jede Gruppe mit ausreichenden Details zur Replikation, einschlie√ülich wie und wann sie verabreicht wurden</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Outcomes</td>
    <td style="border:1px solid black; padding:8px;">6a</td>
    <td style="border:1px solid black; padding:8px;">Vollst√§ndig definierte, vorab festgelegte prim√§re und sekund√§re Endpunkte, einschlie√ülich wie und wann sie gemessen wurden</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">6b</td>
    <td style="border:1px solid black; padding:8px;">√Ñnderungen der Endpunkte nach Beginn der Studie, mit Begr√ºndungen</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Stichprobengr√∂√üe</td>
    <td style="border:1px solid black; padding:8px;">7a</td>
    <td style="border:1px solid black; padding:8px;">Wie die Stichprobengr√∂√üe bestimmt wurde</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">7b</td>
    <td style="border:1px solid black; padding:8px;">Falls zutreffend, Erkl√§rung von Zwischenanalysen und Abbruchkriterien</td>
  </tr>
</table>

https://www.equator-network.org/reporting-guidelines/consort/

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

Studiendesign f√ºr Phase-III RCT (Methodenteil) - CONSORT Checkliste

<small>

<table style="width:100%; border:1px solid black; border-collapse:collapse;">
  <tr>
    <th style="border:1px solid black; padding:8px;">Abschnitt/Thema</th>
    <th style="border:1px solid black; padding:8px;">Punkt Nr.</th>
    <th style="border:1px solid black; padding:8px;">Checkliste Punkt</th>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Randomisierung: Sequenzgenerierung</td>
    <td style="border:1px solid black; padding:8px;">8a</td>
    <td style="border:1px solid black; padding:8px;">Methode zur Generierung der zuf√§lligen Zuweisungssequenz</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">8b</td>
    <td style="border:1px solid black; padding:8px;">Art der Randomisierung; Details zu Einschr√§nkungen (wie Blockbildung und Blockgr√∂√üe)</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Randomisierung: Zuweisungsmechanismus</td>
    <td style="border:1px solid black; padding:8px;">9</td>
    <td style="border:1px solid black; padding:8px;">Mechanismus zur Implementierung der zuf√§lligen Zuweisungssequenz (wie nummerierte Beh√§lter), einschlie√ülich Ma√ünahmen zur Geheimhaltung der Sequenz</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Randomisierung: Durchf√ºhrung</td>
    <td style="border:1px solid black; padding:8px;">10</td>
    <td style="border:1px solid black; padding:8px;">Wer die zuf√§llige Zuweisungssequenz erstellt hat, wer die Teilnehmer eingeschrieben hat und wer die Teilnehmer zugewiesen hat</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Verblindung</td>
    <td style="border:1px solid black; padding:8px;">11a</td>
    <td style="border:1px solid black; padding:8px;">Falls durchgef√ºhrt, wer nach der Zuweisung zur Intervention verblindet war (z.B. Teilnehmer, Pflegekr√§fte, Ergebnispr√ºfer) und wie</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">11b</td>
    <td style="border:1px solid black; padding:8px;">Falls relevant, Beschreibung der √Ñhnlichkeit der Interventionen</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Statistische Methoden</td>
    <td style="border:1px solid black; padding:8px;">12a</td>
    <td style="border:1px solid black; padding:8px;">Statistische Methoden zum Vergleich von Gruppen f√ºr prim√§re und sekund√§re Endpunkte</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">12b</td>
    <td style="border:1px solid black; padding:8px;">Methoden f√ºr zus√§tzliche Analysen, wie Subgruppenanalysen und angepasste Analysen</td>
  </tr>
</table>

https://www.equator-network.org/reporting-guidelines/consort/

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Beispieltext Studiendesign f√ºr Phase-III RCT (Methodenteil)

*The [...] trial was a double-blind, placebo-controlled randomized clinical trial that enrolled patients with [...]. Randomization was performed using [...].  The study protocol was described elsewhere [Referenz] and performed with no significant changes.
The  trial was conducted at [...] study centers (Name der Institute) from [...] to [...]. The study was registered on [...], reported per the Consolidated Standards of Reporting Trials (CONSORT) reporting guideline for nonpharmacological treatments, and approved by the [Name der Ethikkommission]. Participants signed informed consent forms per the Declaration of Helsinki guidelines.*

*Die [‚Ä¶]-Studie war eine doppelblinde, placebokontrollierte, randomisierte klinische Studie, die Patienten mit [‚Ä¶] einschloss. Die Randomisierung wurde mithilfe von [‚Ä¶] durchgef√ºhrt. Das Studienprotokoll wurde an anderer Stelle beschrieben [Referenz] und ohne signifikante √Ñnderungen durchgef√ºhrt. Die Studie wurde in [‚Ä¶] Studienzentren (Name der Institute) von [‚Ä¶] bis [‚Ä¶] durchgef√ºhrt. Die Studie wurde am [‚Ä¶] registriert, gem√§√ü den CONSORT-Richtlinien f√ºr die Berichterstattung √ºber nicht-pharmakologische Behandlungen berichtet und von der [Name der Ethikkommission] genehmigt. Die Teilnehmer unterzeichneten Einverst√§ndniserkl√§rungen gem√§√ü den Richtlinien der Deklaration von Helsinki.*

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Endpunkte und Outcomes in Klinischen Studien**

* Endpunkte sind messbare Ereignisse oder Ergebnisse, um den Erfolg oder Misserfolg einer Intervention zu bewerten.

* Sie geben an, worauf eine Studie abzielt, und dienen als Grundlage zur Beurteilung der Wirksamkeit und Sicherheit.

* Endpunkte werden i.d.R. hierarchisiert (z.B. Prim√§re vs. Sekund√§re Endpunkte)

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Prim√§re Endpunkte**

*	Definition: Der prim√§re Endpunkt ist das Hauptziel der Studie und stellt die wichtigste Messgr√∂√üe zur Bewertung der Wirksamkeit dar.

*	Beispiele:
  
  *	In einer Psychotherapiestudie: Reduktion von Depressionssymptomen gemessen durch eine validierte Skala (z. B. Beck-Depressions-Inventar).
	
	*	In einer Medikamentenstudie: √úberlebensrate, Symptomfreiheit nach einer bestimmten Zeit.

$\rightarrow$	Bedeutung: Signifikanz des prim√§ren Endpunkts entscheidet √ºber den Erfolg oder Misserfolg der Studie.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Sekund√§re Endpunkte**

*	Definition: Sekund√§re Endpunkte sind zus√§tzliche Messgr√∂√üen, die zur umfassenderen Bewertung der Intervention herangezogen werden.

*	Beispiele (bezogen auf Depression als prim√§ren Endpunkt):
	
	*	Verbesserung der Lebensqualit√§t.
	
	*	Reduktion von Angstzust√§nden bei einer Therapie.
	
	*	Nebenwirkungen oder Langzeiteffekte.

$\rightarrow$ Bedeutung: Sekund√§re Endpunkte liefern erg√§nzende Informationen und helfen, weitere Aspekte der Wirksamkeit und Sicherheit zu verstehen.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

**Prim√§re Endpunkte vs. sekund√§re Endpunkte (Studienbeispiel - Methodenteil)**

Praktische Bedeutung f√ºr Psychotherapie-Studien:

*	Ein klar definierter prim√§rer Endpunkt hilft, den Fokus der Studie zu behalten und die Hauptfrage zu beantworten.

*	Sekund√§re Endpunkte bieten wertvolle zus√§tzliche Einsichten und unterst√ºtzen die Interpretation der Ergebnisse.

<br>

<table style="width:50%; margin:auto; border:1px solid black; border-collapse:collapse;">
  <tr>
    <th style="border:1px solid black; padding:8px;">Prim√§re Endpunkte</th>
    <th style="border:1px solid black; padding:8px;">Sekund√§re Endpunkte</th>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Hauptziel der Studie</td>
    <td style="border:1px solid black; padding:8px;">Erg√§nzende, zus√§tzliche Ziele</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Wesentliche Grundlage f√ºr Studienerfolg</td>
    <td style="border:1px solid black; padding:8px;">Hilfreich zur umfassenden Bewertung</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Zentrale Messgr√∂√üe f√ºr die Wirksamkeit</td>
    <td style="border:1px solid black; padding:8px;">Weitere Messgr√∂√üen zur Unterst√ºtzung</td>
  </tr>
</table>

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

**Prim√§re Endpunkte vs. sekund√§re Endpunkte**

$\rightarrow$	Signifikanz des prim√§ren Endpunkts entscheidet √ºber den Erfolg oder Misserfolg der Studie.

Zentral f√ºr die statistische Auswertung:

* Stichprobenumfangsplanung (Poweranalyse) wird i.d.R. am erwarteten Effekt im prim√§ren Endpunkt orientiert
  
* Signifikanzniveau gilt f√ºr Hypothesentest des prim√§ren Endpunkts (**konfirmatorisches Ergebnis**)
  
* (mehrere) sekund√§re Endpunkte $\rightarrow$ $\alpha$-Fehler Kumulierung (erh√∂hte Typ-I-Fehlerrate)

  * Problem: Stichprobengr√∂√üe $(N)$ durch Effekt im prim√§ren Endpunkt festgelegt $\rightarrow$ Typ-I-Fehlerkorrektur w√ºrde bewirken, dass sekund√§re Endpunkte nur schwer signifikant werden
  
  * L√∂sung in der Praxis: Hypothesentests f√ºr sekund√§re Endpunkte werden nicht f√ºr $\alpha$-Fehler korrigiert
  
  * Vorsicht bei der Interpretation: Ergebnisse multipler, nicht-kontrollierter Tests sind **explorative Ergebnisse** (nicht hypothesenpr√ºfend, sondern hypothesengenerierend)

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Beispieltext Endpunkte (Methodenteil)

*Assessments were performed by trained psychiatrists and psychologists blinded for patients‚Äô condition. Participants were assessed at baseline and then [...] weeks, [...] weeks, [...] weeks (primary endpoint), and [...] weeks (secondary endpoint) after treatment onset. Adverse effects were recorded at [...] weeks after treatment onset.
The primary outcome was the change in [...] scores until [...] weeks. Secondary outcomes included clinical response (defined as 50% or greater improvement) and remission (defined as a ... score less than ...) as well as changes in the [...] scales.*

*Die Messungen wurden von geschulten Psychiatern und Psychologen durchgef√ºhrt, die f√ºr die Gruppenzugeh√∂rigkeit der Patienten verblindet waren. Die Teilnehmer wurden zu Beginn (Baseline) sowie [‚Ä¶] Wochen, [‚Ä¶] Wochen, [‚Ä¶] Wochen (prim√§rer Endpunkt) und [‚Ä¶] Wochen (sekund√§rer Endpunkt) nach Beginn der Behandlung beurteilt. Nebenwirkungen wurden [‚Ä¶] Wochen nach Beginn der Behandlung erfasst.
Der prim√§re Endpunkt war die Ver√§nderung der [‚Ä¶]-Werte bis [‚Ä¶] Wochen. Sekund√§re Endpunkte umfassten das klinische Ansprechen (definiert als eine Verbesserung von 50% oder mehr) und die Remission (definiert als ein [‚Ä¶]-Wert unter ‚Ä¶) sowie Ver√§nderungen auf den [‚Ä¶]-Skalen.*

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Itention-to-treat vs. Per-protocol Analysen**

Intention-to-Treat Analyse (ITT)

*	Definition: Alle Teilnehmer, die einer Behandlungsgruppe zu Beginn der Studie zuf√§llig zugewiesen wurden, werden in die Analyse einbezogen, unabh√§ngig davon, ob sie die zugewiesene Behandlung vollst√§ndig durchgef√ºhrt haben oder nicht.

*	Vorteile:
	
	*	Erhalt der Randomisierung: Minimiert Bias und bewahrt die Vergleichbarkeit der Gruppen.
	
	*	Realit√§tsn√§he: Gibt ein realistisches Bild der Wirksamkeit einer Intervention in der Praxis.

*	Beispiel: Ein Teilnehmer, der eine Therapie vorzeitig abbricht, wird weiterhin der urspr√ºnglichen Gruppe zugerechnet.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Itention-to-treat vs. Per-protocol Analysen**

Per-Protocol Analyse (PP)

*	Definition: Nur die Teilnehmer, die die Behandlung genau nach Protokoll durchgef√ºhrt haben, werden in die Analyse aufgenommen.

*	Vorteile:

	*	Reine Wirksamkeitspr√ºfung: Bietet eine Bewertung der optimalen Wirkung der Intervention unter idealen Bedingungen.

*	Nachteil:

	*	Gefahr von Bias: Durch den Ausschluss von Teilnehmern, die das Protokoll nicht befolgen, kann die Vergleichbarkeit zwischen den Gruppen beeintr√§chtigt werden.

*	Beispiel: Teilnehmer, die eine Therapie abbrechen, werden nicht in die Analyse einbezogen.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Itention-to-treat vs. Per-protocol Analysen**

Praktische Relevanz:

*	Die ITT-Analyse ist der Goldstandard f√ºr die Bewertung der Wirksamkeit in klinischen Studien, da sie die tats√§chliche klinische Praxis besser widerspiegelt.
	
*	Per-Protocol-Analysen bieten zus√§tzliche Informationen zur maximalen Wirksamkeit der Behandlung.
	
* Die Wahl zwischen ITT- und Per-Protocol-Analysen beeinflusst die Interpretation der Studienergebnisse und sollte klar definiert und begr√ºndet sein.

<table style="width:70%; margin:auto; border:1px solid black; border-collapse:collapse;">
  <tr>
    <th style="border:1px solid black; padding:8px;">ITT-Analyse</th>
    <th style="border:1px solid black; padding:8px;">Per-Protocol-Analyse</th>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Ber√ºcksichtigt alle Teilnehmer</td>
    <td style="border:1px solid black; padding:8px;">Nur Teilnehmer, die das Protokoll einhalten</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Erhalt der Randomisierung</td>
    <td style="border:1px solid black; padding:8px;">Risiko von Verzerrungen durch Ausf√§lle</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Realit√§tsnahe Ergebnisse</td>
    <td style="border:1px solid black; padding:8px;">Ergebnisse unter idealen Bedingungen</td>
  </tr>
</table>

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

**Monozentrische vs. Multizentrische Studien**

Monozentrische Studien:

*	Definition: Studien, die an einem einzigen Standort (z.B. Klinik oder Forschungseinrichtung) durchgef√ºhrt werden.

*	Vorteile:
	
	*	Einheitliche Bedingungen: Kontrollierte und konsistente Durchf√ºhrung.
	
	*	Kosteng√ºnstiger: Oft einfacher und kosteng√ºnstiger durchf√ºhrbar.
	
	*	Leichtere Koordination: Weniger organisatorischer Aufwand.
	
*	Nachteile:

	*	Geringere Generalisierbarkeit: Ergebnisse sind m√∂glicherweise nicht auf andere Standorte oder Populationen √ºbertragbar.

	*	Begrenzte Teilnehmerzahl: Weniger Teilnehmer im Vergleich zu multizentrischen Studien.

*	Beispiele: Pilotstudien, kleinere klinische Studien zur √úberpr√ºfung erster Hypothesen.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

**Monozentrische vs. Multizentrische Studien**

Multizentrische Studien:

*	Definition: Studien, die an mehreren Standorten gleichzeitig durchgef√ºhrt werden.

*	Vorteile:
	
	*	H√∂here Generalisierbarkeit: Ergebnisse sind repr√§sentativer und √ºbertragbarer auf verschiedene Populationen und Standorte.
	
	*	Gr√∂√üere Teilnehmerzahl: Mehr Teilnehmer erh√∂hen die statistische Aussagekraft.
	
	*	Breitere Vergleichbarkeit: Variabilit√§t zwischen Standorten erm√∂glicht umfassendere Beurteilungen.
	
*	Nachteile:

	*	Komplexere Koordination: H√∂herer organisatorischer Aufwand und Kommunikationsbedarf.

	*	H√∂here Kosten: Meist teurer und ressourcenintensiver.

*	Beispiele: Gro√üe klinische Studien zu neuen Medikamenten, nationale oder internationale Studien.
	
** $\rightarrow$ Zentrumseffekte sollten (statistisch) ber√ºcksichtigt werden**

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Monozentrische vs. Multizentrische Studien**

Multizentrische Studien - statistische Kontrolle von Zentrumseffekten im LMM (2 Optionen)

1 - Kontrolle mittels Kovariate (Fixed Effekt):

```{r eval=FALSE}
lmer(y ~ time * group + center + (time|subject))
```

* leichter zu sch√§tzen (nur 1 Modellkoeffizient), aber komplexere Hierarchie nicht abbildbar

2 - Kontrolle mittels Random Effekt:

```{r eval=FALSE}
lmer(y ~ time * group + (time|center/subject))
```

* komplexer zu sch√§tzen (k Varianzen f√ºr pro Zentrum; kann in kleinen Stichproben zu Konvergierungsproblemen f√ºhren), aber flexibler

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Poweranalyse

**Zur Erinnerung - Warum Poweranalyse?**

* Bestimmung der ben√∂tigten Stichprobengr√∂√üe: Um sicherzustellen, dass die Studie ausreichend Teilnehmer hat, um statistisch signifikante Effekte zu erkennen ( $\beta$-Fehler vermeiden).

* Optimierung von Ressourcen: Ressourcen wie Zeit und Kosten effizient einsetzen, indem die Stichprobengr√∂√üe so gew√§hlt wird, dass unn√∂tig gro√üe Studien vermieden werden.

***

Immer n√∂tige Zutaten (neben anderen - je nach Modell):

* Signifikanzniveau $(\alpha)$

* gew√ºnschte Power $(1-\beta)$, i.d.R. mindestens 80%

* Effektsch√§tzung

* Stichprobengr√∂√üe (oft gesucht)

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Poweranalyse

**Poweranalyse f√ºr das LMM - Herausforderungen**

* Anzahl von Messungen muss auf mehreren Ebenen ber√ºcksichtigt werden (Messungen, Personen, Zentren...)

* F√ºr eine genaue Sch√§tzung m√ºssen viele Komponenten bekannt sein

  * F√ºr fixed Effekte sind i.d.R. Sch√§tzungen/Vorstellungen verf√ºgbar (Effektst√§rke)
  
  * F√ºr Varianzkomponenten (random Effekte) i.d.R. unbekannt.
  
  * Gr√∂√üere Vorstudien - hilfreich, unterscheiden sich jedoch oft in Details
  
  * Kleinere Pilotstudien - hilfreich, jedoch oft zu klein f√ºr sinnvolle Sch√§tzung
  
* Einf√ºhren von Kovariaten kann die optimalen Stichprobengr√∂√üen auf jedem Level √§ndern

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Poweranalyse

**Simulationsbasierte Poweranalyse**

* F√ºr genaue Powersch√§tzungen m√ºssen Daten (inklusive fixed und random Effekte simuliert werden)

* Sch√§tzer f√ºr fixed und random Effekte m√ºssen angegeben werden

* Logik:

  * Daten erstellen, die in etwa so aussehen, wie in unserer Studie
  
  * In diesen Daten LMM berechnen und den Effekt, der uns interessiert auf Signifikanz pr√ºfen
  
  * Vorgang f√ºr stabile Ergebnisse oft wiederholen (i.d.R. 1000 oder 10000 mal) 
  
  * Power (%) = Anteil der Durchg√§nge, in denen Test signifikant war

* Implementierung simulationsbasierte Poweranalysen im R-Paket `simr`

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Poweranalyse

**Simulationsbasierte Poweranalyse**

<small>

.pull-left[

Datensatzstruktur erstellen (Anzahl Personen, Gruppen, Zeitpunkte):

```{r eval=FALSE}
library(simr)

subj <- factor(1:10) # 10 Personen
class_id <- letters[1:5] # 5 Klassen
time <- 0:2 # 3 Messzeitpunkte
group <- c("control", "intervention")

subj_full <- rep(subj, 15)
class_full <- rep(rep(class_id, each=10), 3)
time_full <- rep(time, each=50)
group_full <- rep(rep(group, each=5), 15)

data <- data.frame(id=subj_full, 
                     class=class_full, 
                     treatment=group_full, 
                     time=time_full)
```

```{r echo=FALSE}
library(simr)

subj <- factor(1:10) # 10 Personen
class_id <- letters[1:5] # 5 Klassen
time <- 0:2 # 3 Messzeitpunkte
group <- c("control", "therapy")

subj_full <- rep(subj, 15)
class_full <- rep(rep(class_id, each=10), 3)
time_full <- rep(time, each=50)
group_full <- rep(rep(group, each=5), 15)

data <- data.frame(id=subj_full, 
                     class=class_full, 
                     group=group_full, 
                     time=time_full)
```
]

.pull-right[

Blick in den simulierten Datensatz (erste 10 Zeilen):

```{r}
head(data, 10)
```
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Poweranalyse

<small>

**Simulationsbasierte Poweranalyse**

Wir wollen in der Studie folgendes Modell nutzen:

```{r eval=FALSE}
lmer(ùë¶ ~ group * time + (1|class/id), data = data)
```

Fixed Effekte und Varianzkomponenten m√ºssen f√ºr die genaue Simulation angegeben/gesch√§tzt werden:

```{r eval=FALSE}
## Intercept und slopes f√ºr group, time und treatment:time

fixed <- c(5, 0, 1, 0.6)

## Random intercepts f√ºr Teilnehmer gruppiert in Klassen

rand <- list(0.5, 0.1)

## Residualvarianz

res <- 1
```

```{r echo=FALSE}
## Intercept und slopes f√ºr group, time und treatment:time

fixed <- c(5, 0, 1, 0.6)

## Random intercepts f√ºr Teilnehmer gruppiert in Klassen

rand <- list(0.5, 0.1)

## Residualvarianz

res <- 1
```

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Poweranalyse

<small>

**Simulationsbasierte Poweranalyse**

Basierend auf den Parametern erstellen wir ein "k√ºnstliches" Regressionsmodell:

```{r}
model <- makeLmer(y ~ group*time + (1|class/id), fixef=fixed, VarCorr=rand, sigma=res, data=data)
model
```

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Poweranalyse

<small>

**Simulationsbasierte Poweranalyse**

Wir analysieren die erreichte Power f√ºr den Interaktionseffekt:

```{r}
powerSim(model, nsim=100, test = fixed("grouptherapy:time", method = "t"))
```

***
**Anmerkung:** Es werden im Beispiel aus Zeitgr√ºnden 100 Simulationen durchgef√ºhrt. F√ºr eine Studie w√ºrde man √∂fter simulieren (z.B. `nsim` = 1000 oder besser 10000) 


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Poweranalyse

<small>

**Klassische Poweranalyse**

* Aufgrund der Schwierigkeiten bzgl. Sch√§tzung der Varianzkomponenten wird in der Praxis oft eine klassische Poweranalyse herangezogen

* Statt eines LMMs wird eine konventioneller Test (ohne random Effekte) gepr√ºft

* Diese Sch√§tzung ist **konsevativer**, da Ber√ºcksichtigung von random Effekten die Power tendenziell eher erh√∂ht

* Beispiel:

  * Im LMM: Unterschied zwischen den durchschnittlichen Steigungen von 2 Gruppen (t-verteilt)
  
  * Konventionell: Unterschied zwischen 2 Durchschnittswerten (t-verteilt)

* Diese Analysen k√∂nnen auf Basis herk√∂mmlicher Effektst√§rkesch√§tzungen berechnet werden (fixed Effekte)

* Implementierung klassischer Poweranalysen im R-Paket `pwr`

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Poweranalyse

<small>

**Klassische Poweranalyse - Beispiel 2 Gruppen RCT**

.pull-left[
```{r}
library(pwr)

pwr.t.test(d = 0.5, 
           sig.level = 0.05, 
           power = 0.80, 
           type = "two.sample", 
           alternative = "two.sided")
```
]

.pull-right[
* Beispiel: Vergleich der durchschnittlichen Ver√§nderungen von 2 Gruppen

* Annahme eines mittleren Effekts (d=0.5, nach Cohen)

* $\alpha=.05$

* $1-\beta=.80$ (wird i.d.R. als Untergrenze definiert)

* Es werden $N=128$ Personen ben√∂tigt ( $n=64$ pro Gruppe)
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

**Exkurs: Kategoriale Outcomes f√ºr Therapieansprechen**

Response (50% Verbesserung):

* Definition: Eine Verbesserung um 50% oder mehr im Vergleich zum Ausgangswert eines Messinstruments (z.B. Skalen zur Symptomerfassung).

* Bedeutung: 

  * Wird h√§ufig als Kriterium zur Beurteilung des klinischen Ansprechens einer Therapie verwendet. 
  
  * Ein Patient, der eine 50%ige Verbesserung zeigt, wird als ‚ÄúResponder‚Äù bezeichnet.

* Beispiel: Bei der Behandlung von Depressionen bedeutet dies eine Reduktion der Symptome um mindestens 50% gem√§√ü einer Skala wie dem Hamilton-Depressions-Skala (HAMD).

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

**Exkurs: Kategoriale Outcomes f√ºr Therapieansprechen**

Remission:

*	Definition: 

  * Ein Zustand, bei dem die Symptome einer Erkrankung auf ein normales oder nahezu normales Niveau reduziert werden
  
  * H√§ufig definiert durch einen festgelegten Schwellenwert auf einer Symptombewertungsskala.
	
*	Bedeutung: 

  * Remission bedeutet, dass die Krankheitssymptome minimal oder nicht mehr nachweisbar sind und der Patient sich weitgehend normal f√ºhlt. 
  
  * Sie stellt ein anspruchsvolleres Ziel als eine blo√üe Verbesserung dar.

*	Beispiel: Ein Patient gilt als in Remission, wenn der HAMD-Score unter einen bestimmten Wert f√§llt, der als symptomfrei oder symptomarm definiert wird (z.B. HAMD ‚â§ 7).	
	
	
---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

**Exkurs: Kategoriale Outcomes f√ºr Therapieansprechen**

Reliable change index (RCI)

* Statistisches Ma√ü, das verwendet wird, um die Signifikanz einer Ver√§nderung auf individueller Ebene zu beurteilen.

* Zeigt an, ob die Ver√§nderung in den Testergebnissen einer Person zwischen zwei Zeitpunkten gr√∂√üer ist, als es durch Messfehler (eines Tests) erkl√§rbar w√§re


$$\text{RCI} = \frac{\text{Post-Test-Score} - \text{Pre-Test-Score}}{\text{Standard Error of Difference (SE\(_{\text{diff}}\))}}$$
	
$$\text{SE}_{\text{diff}} = \sqrt{2 \cdot (\text{Standard Error of Measurement})^2}$$
$\rightarrow$ Der Standardfehler der Messung basiert auf der Reliabilit√§t des Tests und seiner Standardabweichung.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)
.pull-left[

<small>

**Exkurs: Kategoriale Outcomes f√ºr Therapieansprechen**

Reliable change index (RCI)


Interpretation des RCI:

*	Positiver Wert (> 1.96): Die Ver√§nderung ist signifikant und kann als echte Verbesserung interpretiert werden 

  * bei einem z-Wert von 1.96 entspricht dies einer Signifikanz auf dem 5%-Niveau

*	Negativer Wert (< -1.96): Die Ver√§nderung ist signifikant und zeigt eine Verschlechterung an.

*	Wert im Bereich von -1.96 bis 1.96: Keine verl√§ssliche Ver√§nderung; die Ver√§nderung k√∂nnte durch Messfehler bedingt sein.
]

.pull-right[
```{r echo=FALSE, fig.height=6}
set.seed(123)
data <- data.frame(
  Pre_Score = runif(100, min = 0, max = 100),
  Post_Score = runif(100, min = 0, max = 100)
)

# Create categories based on score change
data$Category <- cut(
  data$Post_Score - data$Pre_Score,
  breaks = c(-Inf, -10, 10, Inf),
  labels = c("Verschlechtert", "Unver√§ndert", "Verbessert")
)


# Plotting
ggplot(data, aes(x = Pre_Score, y = Post_Score)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_abline(intercept = 0, slope = 1, color = "black", linetype = "dashed") + # Reference line
  geom_ribbon(aes(ymin = Pre_Score - 15, ymax = Pre_Score + 15), fill = "lightgrey", alpha = 0.4) +
  labs(
    x = "Pr√§-Therapie Score",
    y = "Post-Therapie Score",
    shape = ""
  ) +
  coord_cartesian(ylim = c(0,120), xlim = c(0,120)) +
  theme(text = element_text(size = 20)) +
  annotate("text", x = 30, y = 110, label = "Reliabel verschlechtert", color = "darkred", size = 6) +
  annotate("text", x = 95, y = 0, label = "Reliabel verbessert", color = "darkgreen", size = 6) +
  annotate("text", x = 110, y = 110, label = "Unver√§ndert", color = "black", angle = 45, size = 6)
```

]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Exkurs: Kategoriale Outcomes f√ºr Therapieansprechen**

Reliable change index (RCI)

Beispiel: 

Ein Patient erh√§lt zu Beginn einer Therapie (Pre-Test) einen Score von 20 auf einer Depressionsskala und am Ende (Post-Test) einen Score von 10. Mit einem berechneten $SE_{\text{diff}}$ von 4 betr√§gt der RCI:

$$\text{RCI} = \frac{10 - 20}{4} = -2.5$$

Da der Wert kleiner als -1.96 ist, zeigt er eine verl√§ssliche Verbesserung.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)
.pull-left[

<small>
**Exkurs: Kategoriale Outcomes f√ºr Therapieansprechen - Reliable and clinically significant change**

* Oft wird der RCI mit einem Remissionskriterium kombiniert

* Verbesserungen sind dann vom Messfehler befreit und klinisch bedeutsam

* Hier wurde ein Remissionskrierium von Score < 50 gew√§hlt
]

.pull-right[
```{r echo=FALSE, fig.height=6}
set.seed(123)
data <- data.frame(
  Pre_Score = runif(100, min = 0, max = 100),
  Post_Score = runif(100, min = 0, max = 100)
)

# Create categories based on score change
data$Category <- cut(
  data$Post_Score - data$Pre_Score,
  breaks = c(-Inf, -10, 10, Inf),
  labels = c("Verschlechtert", "Unver√§ndert", "Verbessert")
)

data$Remission = NA
data$Remission[data$Post_Score < 50] = "in Remission"
data$Remission[data$Post_Score >= 50] = "nicht in Remission"


# Plotting
ggplot(data, aes(x = Pre_Score, y = Post_Score, shape = Remission)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_abline(intercept = 0, slope = 1, color = "black", linetype = "dashed") + # Reference line
  geom_hline(yintercept = 50) +
  geom_ribbon(aes(ymin = Pre_Score - 15, ymax = Pre_Score + 15), fill = "lightgrey", alpha = 0.4) +
  labs(
    x = "Pr√§-Therapie Score",
    y = "Post-Therapie Score",
    shape = ""
  ) +
  coord_cartesian(ylim = c(0,120), xlim = c(0,120)) +
  theme(text = element_text(size = 20), legend.position = "bottom") +
  annotate("text", x = 30, y = 110, label = "Reliabel verschlechtert", color = "darkred", size = 6) +
  annotate("text", x = 95, y = 0, label = "Reliabel verbessert", color = "darkgreen", size = 6) +
  annotate("text", x = 110, y = 110, label = "Unver√§ndert", color = "black", angle = 45, size = 6)
```

]


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

<small>

**Sensitivit√§tsanalysen**

*	Definition: Eine Sensitivit√§tsanalyse bewertet, wie empfindlich die Ergebnisse einer klinischen Studie gegen√ºber √Ñnderungen in den Annahmen, Methoden oder Parametern des Modells sind.

*	Ziel: Sicherstellung der Robustheit und Zuverl√§ssigkeit der Studienergebnisse durch die Analyse, wie sich √Ñnderungen auf die Hauptschlussfolgerungen auswirken.

***

Typische Anwendungsf√§lle in Klinischen Studien

*	Umgang mit fehlenden Daten: Analyse der Auswirkungen verschiedener Annahmen √ºber fehlende Werte (z.B. vollst√§ndig zuf√§lliges Fehlen, imputierte Werte).

*	Abweichungen vom Protokoll: Ber√ºcksichtigung von Teilnehmern, die sich nicht an das Studienprotokoll gehalten haben (z.B. Intention-to-Treat-Analyse vs. Per-Protocol-Analyse).

*	√Ñnderung von Modellparametern: Bewertung, wie sich √Ñnderungen in den Parametern oder Variablen auf die Ergebnisse auswirken.


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Beispieltext Endpunkte (Methodenteil)

<small>

*The sample size was estimated for a power of 80% and a 2-tailed Œ±-level of 5% for a 2-group comparison of change over time in the [primary outcome]. Our study was powered to detect a between-group difference of d=0.5, which represents a moderate effect size (Cohen, 1992). Therefore, a targeted sample of 128 patients (50 per group) was obtained.*
*Data were analyzed in the intention-to-treat sample. Analyses were performed in R in its most recent version. Results were significant at a P value less than .05. For all continuous outcomes, we calculated 2-level linear mixed-effects regression models (LMM), assuming a linear relationship over time with 5 (up to week 6) repeated measurements per patient, respectively. The model included time, group and their interaction as fixed effects. Measurements were assumed to be nested within patients. Effect sizes were calculated as Cohen's d. As secondary outcomes, response (at least 50 improvement from baseline on the [primary outcome]) and remission ([primary outcome] scores below XX) were computed for each group.*

*Die Stichprobengr√∂√üe wurde f√ºr eine Power von 80% und ein zweiseitiges Œ±-Niveau von 5% f√ºr einen Vergleich der Ver√§nderung √ºber die Zeit in der [prim√§ren Zielgr√∂√üe] zwischen zwei Gruppen gesch√§tzt. Unsere Studie war darauf ausgelegt, einen Unterschied zwischen den Gruppen mit d=0,5 zu erkennen, was eine moderate Effektgr√∂√üe darstellt (Cohen, 1992). Daher wurde eine angestrebte Stichprobe von 128 Patienten (50 pro Gruppe) erreicht.*
*Die Daten wurden in der Intention-to-Treat-Stichprobe analysiert. Die Analysen wurden in der aktuellsten Version von R durchgef√ºhrt. Die Ergebnisse wurden als signifikant betrachtet, wenn der P-Wert kleiner als 0.05 war. F√ºr alle kontinuierlichen Endpunkte berechneten wir zweistufige lineare gemischte Regressionsmodelle (LMM), wobei wir von einer linearen Beziehung √ºber die Zeit mit 5 (bis zur Woche 6) Messwiederholungen pro Patient ausgingen. Das Modell umfasste Zeit, Gruppe und deren Interaktion als feste Effekte. Die Messungen wurden als in den Patienten verschachtelt betrachtet. Effektgr√∂√üen wurden als Cohen‚Äôs d berechnet. Als sekund√§re Endpunkte wurden das Ansprechen (mindestens 50% Verbesserung gegen√ºber dem Ausgangswert auf der [prim√§ren Zielgr√∂√üe]) und die Remission ([prim√§re Zielgr√∂√üe]-Werte unter XX) f√ºr jede Gruppe berechnet.*

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Studiendesign f√ºr Phase-III RCT (Ergebnisteil) - CONSORT Checkliste

<table style="width:100%; border:1px solid black; border-collapse:collapse;">
  <tr>
    <th style="border:1px solid black; padding:8px;">Abschnitt/Thema</th>
    <th style="border:1px solid black; padding:8px;">Punkt Nr.</th>
    <th style="border:1px solid black; padding:8px;">Checkliste Punkt</th>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Teilnehmerfluss (Diagramm wird empfohlen)</td>
    <td style="border:1px solid black; padding:8px;">13a</td>
    <td style="border:1px solid black; padding:8px;">F√ºr jede Gruppe die Anzahl der zuf√§llig zugewiesenen Teilnehmer, die die vorgesehene Behandlung erhalten haben und die f√ºr das prim√§re Ergebnis analysiert wurden</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">13b</td>
    <td style="border:1px solid black; padding:8px;">F√ºr jede Gruppe Verluste und Ausschl√ºsse nach der Randomisierung, zusammen mit Begr√ºndungen</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Rekrutierung</td>
    <td style="border:1px solid black; padding:8px;">14a</td>
    <td style="border:1px solid black; padding:8px;">Zeitpunkte, die die Rekrutierungs- und Nachbeobachtungszeitr√§ume definieren</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">14b</td>
    <td style="border:1px solid black; padding:8px;">Gr√ºnde, warum die Studie beendet oder gestoppt wurde</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Baseline-Daten</td>
    <td style="border:1px solid black; padding:8px;">15</td>
    <td style="border:1px solid black; padding:8px;">Eine Tabelle mit den demografischen und klinischen Ausgangsdaten f√ºr jede Gruppe</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Analysierte Zahlen</td>
    <td style="border:1px solid black; padding:8px;">16</td>
    <td style="border:1px solid black; padding:8px;">F√ºr jede Gruppe die Anzahl der in jeder Analyse eingeschlossenen Teilnehmer (Nenner) und ob die Analyse nach den urspr√ºnglichen Zuweisungsgruppen durchgef√ºhrt wurde</td>
  </tr>
</table>

https://www.equator-network.org/reporting-guidelines/consort/

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Studiendesign f√ºr Phase-III RCT (Ergebnisteil) - CONSORT Checkliste

<table style="width:100%; border:1px solid black; border-collapse:collapse;">
  <tr>
    <th style="border:1px solid black; padding:8px;">Abschnitt/Thema</th>
    <th style="border:1px solid black; padding:8px;">Punkt Nr.</th>
    <th style="border:1px solid black; padding:8px;">Checkliste Punkt</th>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Outcomes und Sch√§tzungen</td>
    <td style="border:1px solid black; padding:8px;">17a</td>
    <td style="border:1px solid black; padding:8px;">F√ºr jedes prim√§re und sekund√§re Ergebnis die Ergebnisse f√ºr jede Gruppe und die gesch√§tzte Effektgr√∂√üe sowie deren Pr√§zision (z.B. 95%-Konfidenzintervall)</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;"></td>
    <td style="border:1px solid black; padding:8px;">17b</td>
    <td style="border:1px solid black; padding:8px;">F√ºr bin√§re Outcomes wird die Darstellung sowohl absoluter als auch relativer Effektgr√∂√üen empfohlen</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Zus√§tzliche Analysen</td>
    <td style="border:1px solid black; padding:8px;">18</td>
    <td style="border:1px solid black; padding:8px;">Ergebnisse anderer durchgef√ºhrter Analysen, einschlie√ülich Subgruppenanalysen und angepasster Analysen, unter Unterscheidung zwischen vordefinierten und explorativen Analysen</td>
  </tr>
  <tr>
    <td style="border:1px solid black; padding:8px;">Sch√§digungen</td>
    <td style="border:1px solid black; padding:8px;">19</td>
    <td style="border:1px solid black; padding:8px;">Alle wichtigen Sch√§digungen oder unbeabsichtigte Effekte in jeder Gruppe (f√ºr spezifische Leitlinien siehe CONSORT f√ºr Sch√§digungen)</td>
  </tr>
</table>

https://www.equator-network.org/reporting-guidelines/consort/


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

**Beispielszenario:**  Vergleich von Kognitiver Verhaltenstherapie (KVT) vs. Kognitive Verhaltenstherapie + Muttraining

Die Studie soll die Wirksamkeit von Kognitiver Verhaltenstherapie (KVT) vs. KVT + Muttraining bei Patienten mit generalisierter Angstst√∂rung vergleichen. Es handelt sich um eine doppelblinde, randomisierte klinische Studie, in der 128 Patienten zuf√§llig einer der beiden Therapieformen zugewiesen werden. Die Behandlungen werden √ºber 6 Wochen hinweg in w√∂chentlichen Sitzungen durchgef√ºhrt.

**Ziel der Studie:** Prim√§rer Endpunkt ist die Ver√§nderung der Angstwerte, gemessen anhand der Hamilton-Angst-Skala (HAM-A), 6 Wochen nach Therapiebeginn. Sekund√§re Endpunkte umfassen die Response, Remission (definiert als HAM-A-Wert unter 7) sowie die Verbesserung der Lebensqualit√§t, gemessen durch das SF-36-Formular.

**Ablauf:** Die Teilnehmer werden von geschulten Therapeuten behandelt, die f√ºr die spezifische Therapieform trainiert sind. Die Bewertung der Ergebnisse erfolgt durch verblindete Psychologen. Nebenwirkungen oder unerw√ºnschte Ereignisse werden dokumentiert.

**Hypothesen:** Es wird erwartet, dass beide Therapieformen zu einer signifikanten Reduktion der Angst f√ºhren, jedoch mit unterschiedlichen Schwerpunkten in der Symptomreduktion und Lebensqualit√§tsverbesserung.

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)


.pull-left[
.code80[
```{r eval=FALSE}
ggplot(data, aes(x = time, y = y, colour = treatment)) +
  stat_summary(aes(group = subject), geom = "line") +
  labs(colour = "", x = "Wochen", y = "HAM-A") +
  theme(text = element_text(size = 20), legend.position = "right")
```
]
* Darstellung der Daten in Linegraph (Deskriptivstatistik)

* I.d.R. bekommt prim√§rer Endpunkt einen eigenen Graphen.

]

.pull-right[
```{r echo=FALSE, fig.height=6}
set.seed(2)
library(powerlmm)
p1 <- study_parameters(n1 = 7,
                       n2 = 64,
                       T_end = 6,
                       fixed_intercept = 20,
                       fixed_slope = -1.5,
                       sigma_subject_intercept = 1.89,
                       sigma_subject_slope = .9,
                       icc_slope = 0.15,
                       # var_ratio = 0.03,
                       sigma_error = 1,
                       cor_subject = -0.5,
                       cohend = 0.5)
data <- simulate_data(p1)

data$treatment = factor(data$treatment, levels = 0:1, labels = c("KVT", "KVTM"))
data$y[data$treatment == "KVTM"] = data$y[data$treatment == "KVTM"] - (mean(data$y[data$time == 0 & data$treatment == "KVTM"]) - mean(data$y[data$time == 0 & data$treatment == "KVT"]) )

data = data[,c("y", "time", "subject", "treatment")]  
  
mod = lmer(y ~ time * treatment + (time|subject), data = data)

ggplot(data, aes(x = time, y = y, colour = treatment)) +
  stat_summary() +
  stat_summary(geom = "line") +
  stat_summary(aes(group = subject), geom = "line", alpha = 0.2) +
  labs(colour = "", x = "Wochen") +
  theme(text = element_text(size = 20), legend.position = "right")

#em = emmeans::emtrends(mod, pairwise ~ treatment, var = "time")

```
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

.code70[
```{r}
mod = lmer(y ~ time * treatment + (time|subject), data = data)
summary(mod)
```
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Ver√§nderung innerhalb beider Gruppen und deren Differenz darstellen:

```{r}
library(emmeans)

em = emmeans::emtrends(mod, pairwise ~ treatment, var = "time")
em
```
]


---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

.pull-left[

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

```{r}
em
```
]

.pull-right[
***

**Beispieltext im Ergebnisteil:**

*Es zeigten sich signifikante Verbesserungen im HAM-A f√ºr die KVT Gruppe $(\beta_{KVT}=-7.32, KI_{95\%} -8.82 \text{ bis } -5.78)$ und die KVTM Gruppe $(\beta_{KVTM}=-9.66, KI_{95\%} -11.16 \text{ bis } -8.14)$. Es wurde ein signifikanter Zeit x Gruppe Interaktionseffekte mit st√§rken Verbesserungen f√ºr die KVTM Gruppe gefunden $(\beta_{Diff}=2.36, t_{126}=2.17, p=.032)$.*

***

Vorsicht: Steigungen m√ºssen mit 6 multipliziert werden, um Ver√§nderung bis zum Endpunkt (Woche 6) der Studie zu berechnen.
]



---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Berechnung der Effekts√§rke

```{r}
eff_size(em, sigma = sum(as.data.frame(VarCorr(mod))[,"sdcor"]), edf = df.residual(mod))
```

***

**Beispieltext im Ergebnisteil:**

*Die Effektst√§rke f√ºr den Zwischengruppeneffekt betrug ein Cohen's d von 0.69 $(KI_{95\%} = 0.06 \text{ bis } 1.32)$. Dies entspricht einem mittleren Effekt.*

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Berechnen der Response und Remissionsraten:

```{r}
data_w = pivot_wider(data, id_cols = c(subject, treatment), names_from = time, names_prefix = "week", values_from = y, )

head(data_w, 10)
```

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

<small>

#### Statistische Analyse von Wirksamkeitsstudien (Efficacy trials)

Berechnen der Response und Remissionsraten:

```{r}
data_w = pivot_wider(data, id_cols = c(subject, treatment), names_from = time, names_prefix = "week", values_from = y, )

data_w$response = data_w$week6 < (data_w$week0 * 0.5) 
data_w$remission = data_w$week6 < 7 
```

.pull-left[
.code80[
```{r}
table(data_w$response, data_w$treatment)

table(data_w$remission, data_w$treatment)
```
]
]
.code80[
.pull-right[
```{r}
prop.table(table(data_w$response, data_w$treatment), 2)

prop.table(table(data_w$remission, data_w$treatment), 2)
```
]
]

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

```{r echo=FALSE}
set.seed(123)  # For reproducibility

# Generate data for 10 clusters arranged diagonally
n_points <- 20  # Number of points per group
groups <- 3     # Number of groups

# Generate the x-values, each group along a diagonal
data <- data.frame(
  Therapiestunden = rep(seq(1, n_points*groups, by = 1)),  # Adjust x-values for groups
  Symptomschwere = c(rnorm(n_points, mean = 2, sd = 0.2) - seq(1, n_points)*0.05,  # Negative slope within each group
                     rnorm(n_points, mean = 3, sd = 0.2) - seq(1, n_points)*0.05,
                     rnorm(n_points, mean = 4, sd = 0.2) - seq(1, n_points)*0.05),  # Y-values for each group with negative slope
  Klinik = rep(1:groups, each = n_points)  # Group labels
)
#data$x = data$x *  rnorm(nrow(data), mean = 1, sd = 0.01)

data$Klinik = factor(data$Klinik, levels = 1:3, labels = c(paste("Klinik", 1:3)))
data$Therapiestunden = data$Therapiestunden / 10
```

.pull-left[
#### Modellvoraussetzungen

```{r warning=TRUE, message=TRUE, eval=FALSE}
model = lmer(Symptomschwere ~ Therapiestunden + (1|Klinik), data = data)

library(performance)
check_model(model)
```
]

.pull-right[
.center[

```{r eval = TRUE, echo = F, out.width = "470px"}
knitr::include_graphics("bilder/vorraussetzungen.png")
```
]

]
---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Troubleshooting

* `Warning: ‚Äûmodel failed to converge"`

* Keine Modellkonvergierung (vermutliche zu viele Parameter bei zu kleiner Stichprobe)

* Ergebnis darf nicht interpretiert werden - Sch√§tzwerte k√∂nnten falsch sein

* L√∂sung 1: Modell vereinfachen, Variablen transformieren (zentrieren, standardisieren)

* L√∂sung 2: Anderen Optimizer verwenden (mehr Iterationen bei maximum likelihood Sch√§tzung erzwingen)

```{r eval=FALSE}
# anderen Optimizer testen bei Konvergierungsproblemen

lmer(y ~ x + (1|group), data = data, control = lmerControl(optimizer = "Nelder_Mead"))
```

---
class: top, left
### Mehrebenenanalyse - Lineare gemischte Modelle

#### Troubleshooting

.pull-left[

* `Warning: "singular fit"`

* Grund 1: Mindestens ein Random Effekt ist 0 (oder beinahe 0)

* Grund 2: Eine Korrelation zwischen Random Effekten ist -1 oder 1 (oder beinahe)

* Nicht zwingend problematisch, aber Hinweis, dass Modell vereinfacht werden k√∂nnte

* Kann auch potentiell auf Multikolliniarit√§t hinweisen (hohe Korrelation zwischen Pr√§diktoren)
]

.pull-right[

```{r echo=FALSE}
set.seed(123)  # For reproducibility

# Generate data for 10 clusters arranged diagonally
n_points <- 20  # Number of points per group
groups <- 3     # Number of groups

# Generate the x-values, each group along a diagonal
data <- data.frame(
  Therapiestunden = rep(seq(1, n_points*groups, by = 1)),  # Adjust x-values for groups
  Symptomschwere = c(rnorm(n_points, mean = 2, sd = 0.2) - seq(1, n_points)*0.05,  # Negative slope within each group
                     rnorm(n_points, mean = 3, sd = 0.2) - seq(1, n_points)*0.05,
                     rnorm(n_points, mean = 4, sd = 0.2) - seq(1, n_points)*0.05),  # Y-values for each group with negative slope
  Klinik = rep(1:groups, each = n_points)  # Group labels
)
#data$x = data$x *  rnorm(nrow(data), mean = 1, sd = 0.01)

data$Klinik = factor(data$Klinik, levels = 1:3, labels = c(paste("Klinik", 1:3)))
data$Therapiestunden = data$Therapiestunden / 10
```

.code40[
```{r warning=TRUE, message=TRUE}
model = lmer(Symptomschwere ~ Therapiestunden + (Therapiestunden|Klinik), data = data)
summary(model)
```
]
]

---
class: top, left
### Take-aways

.full-width[.content-box-gray[
* Lineare gemischte Modelle (LMMs) sind ein wichtiges statistisches Instrument zur Analyse hierarchischer und wiederholter Messdaten, wie sie in klinischen Studien h√§ufig auftreten.

* In klinischen Studien sind prim√§re und sekund√§re Endpunkte entscheidend f√ºr die Bewertung der Wirksamkeit und Sicherheit einer Intervention. Prim√§re Endpunkte bestimmen den Studienerfolg, w√§hrend sekund√§re Endpunkte erg√§nzende Informationen liefern.

* Poweranalysen f√ºr LMMs erfordern Simulation auf Basis vieler Axiome, oft wird daher eine konventionelle Poweranalyse durchgef√ºhrt.

* Diskrete Endpunkte wie Response, Remission oder RCI k√∂nnen ebenfalls zur Bewertung von Therapieerfolg herangezogen werden. 

* Die CONSORT Checkliste ist ein Katalog zur Qualit√§tskontrolle beim Berichten von Methoden und Ergebnissen klinischer Studien.
]

]


